INFO 09-18 07:16:52 llm_engine.py:170] Initializing an LLM engine (v0.5.0) with config: model='facebook/opt-6.7b', speculative_config=None, tokenizer='facebook/opt-6.7b', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, rope_scaling=None, rope_theta=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.float16, max_seq_len=2048, download_dir=None, load_format=LoadFormat.AUTO, tensor_parallel_size=1, disable_custom_all_reduce=False, quantization=None, enforce_eager=True, kv_cache_dtype=auto, quantization_param_path=None, device_config=cuda, decoding_config=DecodingConfig(guided_decoding_backend='outlines'), seed=0, served_model_name=facebook/opt-6.7b)
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:16:54 multiproc_worker_utils.py:216] Worker ready; awaiting tasks
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:16:54 multiproc_worker_utils.py:216] Worker ready; awaiting tasks
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:16:54 multiproc_worker_utils.py:216] Worker ready; awaiting tasks
INFO 09-18 07:16:55 utils.py:623] Found nccl from library libnccl.so.2
INFO 09-18 07:16:55 pynccl.py:65] vLLM is using nccl==2.20.5
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:16:55 utils.py:623] Found nccl from library libnccl.so.2
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:16:55 pynccl.py:65] vLLM is using nccl==2.20.5
INFO 09-18 07:16:55 custom_all_reduce_utils.py:180] reading GPU P2P access cache from /home/lrq/.config/vllm/gpu_p2p_access_cache_for_0,1,2,3.json
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:16:55 custom_all_reduce_utils.py:180] reading GPU P2P access cache from /home/lrq/.config/vllm/gpu_p2p_access_cache_for_0,1,2,3.json
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:16:55 utils.py:623] Found nccl from library libnccl.so.2
INFO 09-18 07:16:55 utils.py:623] Found nccl from library libnccl.so.2
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:16:55 pynccl.py:65] vLLM is using nccl==2.20.5
INFO 09-18 07:16:55 pynccl.py:65] vLLM is using nccl==2.20.5
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:16:55 utils.py:623] Found nccl from library libnccl.so.2
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:16:55 utils.py:623] Found nccl from library libnccl.so.2
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:16:55 pynccl.py:65] vLLM is using nccl==2.20.5
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:16:55 pynccl.py:65] vLLM is using nccl==2.20.5
WARNING 09-18 07:16:55 custom_all_reduce.py:170] Custom allreduce is disabled because it's not supported on more than two PCIe-only GPUs. To silence this warning, specify disable_custom_all_reduce=True explicitly.
[1;36m(VllmWorkerProcess pid=898982)[0;0m WARNING 09-18 07:16:55 custom_all_reduce.py:170] Custom allreduce is disabled because it's not supported on more than two PCIe-only GPUs. To silence this warning, specify disable_custom_all_reduce=True explicitly.
[1;36m(VllmWorkerProcess pid=898984)[0;0m WARNING 09-18 07:16:55 custom_all_reduce.py:170] Custom allreduce is disabled because it's not supported on more than two PCIe-only GPUs. To silence this warning, specify disable_custom_all_reduce=True explicitly.
[1;36m(VllmWorkerProcess pid=898983)[0;0m WARNING 09-18 07:16:55 custom_all_reduce.py:170] Custom allreduce is disabled because it's not supported on more than two PCIe-only GPUs. To silence this warning, specify disable_custom_all_reduce=True explicitly.
INFO 09-18 07:16:56 weight_utils.py:218] Using model weights format ['*.bin']
INFO 09-18 07:17:03 model_runner.py:212] Loading model weights took 12.4036 GB
INFO 09-18 07:17:04 distributed_gpu_executor.py:59] # GPU blocks: 964, # CPU blocks: 512
INFO 09-18 07:17:06 llm_engine.py:759] ---------Start 0'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:17:06 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:17:06 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.508 GB, free space: 2.129GB, frag space: 0.010GB, [(898899, 21.529296875)]
It takes: 0.28s to send model shards
INFO 09-18 07:17:07 worker.py:152] send weights shards takes: 0.33s, sent out: 6.21GB, sent bw: 18.90GB/s
INFO 09-18 07:17:07 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.379 GB, free space: 8.257GB, frag space: 0.075GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 9.483GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.05s to init model weights
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.22s to recv shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes 0.00 to load shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:07 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 10.499 GB, reserved space on GPU 1: 16.660 GB, free space: 5.790GB, frag space: 6.161GB
INFO 09-18 07:17:07 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 34.05GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:07 worker.py:217] After recv kvc shards, allocated space on GPU 1: 14.265 GB, reserved space on GPU 1: 20.473 GB, free space: 1.977GB, frag space: 6.208GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:07 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.499 GB, reserved space on GPU 1: 20.473 GB, free space: 1.977GB, frag space: 9.974GB
INFO 09-18 07:17:07 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:07 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.499 GB, reserved space on GPU 1: 10.641 GB, free space: 11.809GB, frag space: 0.142GB
INFO 09-18 07:17:07 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.629 GB, free space: 12.007GB, frag space: 0.122GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.809GB, frag space: 0.000GB
2417
INFO 09-18 07:17:07 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3381
INFO 09-18 07:17:08 worker.py:202] extend gpu in worker takes: 0.28s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:08 worker.py:202] extend gpu in worker takes: 0.29s
INFO 09-18 07:17:08 llm_engine.py:773] Finished liquid for 0 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.37s, update worker latency: 0.00s, liquid model weights latency: 0.36s, init mem latency: 0.27s, liquid kvc latency: 0.44s, extending gpu blocks latency: 0.29s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.066 GB, free space: 2.570GB, frag space: 0.118GB, current gpu block: #3381
INFO 09-18 07:17:08 llm_engine.py:759] ---------Start 1'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:17:08 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:17:08 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.068 GB, free space: 2.451GB, frag space: 0.120GB, [(898899, 21.20703125)]
It takes: 0.37s to send model shards
INFO 09-18 07:17:08 worker.py:152] send weights shards takes: 0.40s, sent out: 3.11GB, sent bw: 7.87GB/s
INFO 09-18 07:17:08 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.852 GB, reserved space on GPU 0: 17.346 GB, free space: 5.115GB, frag space: 0.494GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.346GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.08s to init model weights
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.28s to recv shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes 0.00 to load shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:08 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 10.238 GB, reserved space on GPU 2: 13.672 GB, free space: 9.115GB, frag space: 3.433GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:09 worker.py:217] After recv kvc shards, allocated space on GPU 2: 16.863 GB, reserved space on GPU 2: 20.297 GB, free space: 2.490GB, frag space: 3.433GB
INFO 09-18 07:17:09 cache_engine.py:159] send kvc shards takes: 0.35s, sent out: 6.60GB, sent bw: 18.77GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:09 worker.py:223] After appending kvc shards, allocated space on GPU 2: 10.238 GB, reserved space on GPU 2: 20.297 GB, free space: 2.490GB, frag space: 10.058GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:09 worker.py:228] After appending kvc shards, allocated space on GPU 2: 10.238 GB, reserved space on GPU 2: 10.305 GB, free space: 12.482GB, frag space: 0.066GB
INFO 09-18 07:17:09 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:17:09 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.270 GB, reserved space on GPU 0: 10.721 GB, free space: 11.740GB, frag space: 0.451GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.346GB, frag space: 0.000GB
INFO 09-18 07:17:09 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:17:09 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.270 GB, reserved space on GPU 0: 10.721 GB, free space: 11.740GB, frag space: 0.451GB, [(898899, 11.91796875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:09 worker.py:152] send weights shards takes: 0.35s, sent out: 3.11GB, sent bw: 8.98GB/s
INFO 09-18 07:17:09 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 10.270 GB, reserved space on GPU 0: 10.721 GB, free space: 11.740GB, frag space: 0.451GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.352GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.05s to init model weights
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to recv shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes 0.00 to load shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:09 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 10.238 GB, reserved space on GPU 3: 13.672 GB, free space: 9.115GB, frag space: 3.433GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:10 cache_engine.py:159] send kvc shards takes: 0.35s, sent out: 6.60GB, sent bw: 18.77GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:10 worker.py:217] After recv kvc shards, allocated space on GPU 3: 16.863 GB, reserved space on GPU 3: 20.297 GB, free space: 2.490GB, frag space: 3.433GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:10 worker.py:223] After appending kvc shards, allocated space on GPU 3: 10.238 GB, reserved space on GPU 3: 20.297 GB, free space: 2.490GB, frag space: 10.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:10 worker.py:228] After appending kvc shards, allocated space on GPU 3: 10.238 GB, reserved space on GPU 3: 10.305 GB, free space: 12.482GB, frag space: 0.066GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:10 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:17:10 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.270 GB, reserved space on GPU 0: 10.721 GB, free space: 11.740GB, frag space: 0.451GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.977GB, frag space: 0.000GB
INFO 09-18 07:17:10 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8179
INFO 09-18 07:17:10 worker.py:202] extend gpu in worker takes: 0.41s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:10 worker.py:202] extend gpu in worker takes: 0.42s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:10 worker.py:202] extend gpu in worker takes: 0.42s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:10 worker.py:202] extend gpu in worker takes: 0.42s
INFO 09-18 07:17:10 llm_engine.py:773] Finished liquid for 1 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.32s, update worker latency: 0.00s, liquid model weights latency: 1.31s, init mem latency: 0.00s, liquid kvc latency: 0.57s, extending gpu blocks latency: 0.43s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.645 GB, reserved space on GPU 0: 20.096 GB, free space: 2.365GB, frag space: 0.451GB, current gpu block: #8179
INFO 09-18 07:17:11 llm_engine.py:759] ---------Start 2'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:17:11 multiproc_gpu_executor.py:242] Shrink to: #3381, currently using blocks: #1
INFO 09-18 07:17:11 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.645 GB, reserved space on GPU 0: 20.098 GB, free space: 2.078GB, frag space: 0.453GB
INFO 09-18 07:17:11 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 10.270 GB, reserved space on GPU 0: 10.721 GB, free space: 11.455GB, frag space: 0.451GB
INFO 09-18 07:17:11 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:17:11 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.270 GB, reserved space on GPU 0: 10.721 GB, free space: 11.455GB, frag space: 0.451GB, [(898899, 12.203125)]
INFO 09-18 07:17:11 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.270 GB, reserved space on GPU 0: 10.721 GB, free space: 11.455GB, frag space: 0.451GB
INFO 09-18 07:17:11 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.366 GB, reserved space on GPU 0: 13.592 GB, free space: 8.564GB, frag space: 0.226GB
INFO 09-18 07:17:11 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.366 GB, reserved space on GPU 0: 16.316 GB, free space: 5.839GB, frag space: 2.950GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.34s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:11 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.42GB/s
INFO 09-18 07:17:11 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.366 GB, reserved space on GPU 0: 16.316 GB, free space: 5.839GB, frag space: 2.950GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.747GB, frag space: 0.000GB
INFO 09-18 07:17:11 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.366 GB, reserved space on GPU 0: 16.316 GB, free space: 5.839GB, frag space: 2.950GB
INFO 09-18 07:17:12 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.991 GB, reserved space on GPU 0: 20.449 GB, free space: 1.707GB, frag space: 0.458GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:12 cache_engine.py:159] send kvc shards takes: 0.47s, sent out: 6.60GB, sent bw: 14.07GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:12 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:17:12 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 22.105 GB, free space: 0.050GB, frag space: 2.157GB
INFO 09-18 07:17:12 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.449 GB, free space: 1.707GB, frag space: 0.501GB
INFO 09-18 07:17:12 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.449 GB, free space: 1.707GB, frag space: 0.501GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.747GB, frag space: 0.000GB
INFO 09-18 07:17:12 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:17:12 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.449 GB, free space: 1.707GB, frag space: 0.501GB, [(898899, 21.951171875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:12 worker.py:165] Before appending weights shards, allocated space on GPU 1: 10.270 GB, reserved space on GPU 1: 10.314 GB, free space: 11.747GB, frag space: 0.045GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:13 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.366 GB, reserved space on GPU 1: 13.623 GB, free space: 8.419GB, frag space: 0.257GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:13 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.366 GB, reserved space on GPU 1: 16.551 GB, free space: 5.491GB, frag space: 3.185GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:13 worker.py:152] send weights shards takes: 0.26s, sent out: 3.10GB, sent bw: 11.95GB/s
INFO 09-18 07:17:13 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.449 GB, free space: 1.707GB, frag space: 0.501GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.491GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:13 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.366 GB, reserved space on GPU 1: 16.551 GB, free space: 5.491GB, frag space: 3.185GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:13 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.991 GB, reserved space on GPU 1: 20.141 GB, free space: 1.901GB, frag space: 0.149GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:13 cache_engine.py:159] send kvc shards takes: 0.49s, sent out: 6.60GB, sent bw: 13.50GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:13 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:13 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.948 GB, reserved space on GPU 1: 21.797 GB, free space: 0.245GB, frag space: 1.849GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:13 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.948 GB, reserved space on GPU 1: 20.141 GB, free space: 1.901GB, frag space: 0.192GB
INFO 09-18 07:17:13 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.449 GB, free space: 1.707GB, frag space: 0.501GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 1.901GB, frag space: 0.000GB
INFO 09-18 07:17:13 llm_engine.py:773] Finished liquid for 2 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.83s, move and shrink latency: -1726640231.14s, update worker latency: 1726640231.14s, liquid model weights latency: 1.99s, init mem latency: 0.00s, liquid kvc latency: 0.83s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.449 GB, free space: 1.707GB, frag space: 0.501GB, current gpu block: #3381
INFO 09-18 07:17:14 llm_engine.py:759] ---------Start 3'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:17:14 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #1
INFO 09-18 07:17:14 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.948 GB, reserved space on GPU 0: 20.451 GB, free space: 1.705GB, frag space: 0.503GB
INFO 09-18 07:17:14 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.012 GB, free space: 11.144GB, frag space: 0.505GB
INFO 09-18 07:17:14 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:17:14 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.012 GB, free space: 11.144GB, frag space: 0.505GB, [(898899, 12.513671875)]
INFO 09-18 07:17:14 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.012 GB, free space: 11.144GB, frag space: 0.505GB
INFO 09-18 07:17:14 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.830 GB, free space: 5.326GB, frag space: 0.130GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:14 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 17.24GB/s
INFO 09-18 07:17:14 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.371 GB, free space: 1.785GB, frag space: 3.670GB
INFO 09-18 07:17:14 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.371 GB, free space: 1.785GB, frag space: 3.670GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:17:14 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.371 GB, free space: 1.785GB, frag space: 3.670GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:14 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.34GB/s
INFO 09-18 07:17:14 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 20.930 GB, free space: 1.226GB, frag space: 0.463GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:17:15 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.344 GB, free space: 0.812GB, frag space: 0.846GB
INFO 09-18 07:17:15 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.867 GB, free space: 1.289GB, frag space: 0.370GB
INFO 09-18 07:17:15 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.867 GB, free space: 1.289GB, frag space: 0.370GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:17:15 llm_engine.py:773] Finished liquid for 3 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.31s, move and shrink latency: 0.12s, update worker latency: -0.11s, liquid model weights latency: 0.61s, init mem latency: 0.00s, liquid kvc latency: 0.70s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.867 GB, free space: 1.289GB, frag space: 0.370GB, current gpu block: #964
INFO 09-18 07:17:15 llm_engine.py:759] ---------Start 4'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:17:15 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:17:15 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.869 GB, free space: 1.287GB, frag space: 0.372GB, [(898899, 22.37109375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.23s to send model shards
INFO 09-18 07:17:15 worker.py:152] send weights shards takes: 0.27s, sent out: 6.19GB, sent bw: 22.62GB/s
INFO 09-18 07:17:15 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.891 GB, free space: 7.265GB, frag space: 0.587GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:17:15 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.62GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:15 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:17:15 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:17:15 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2244
INFO 09-18 07:17:15 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3208
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:16 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:17:16 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:17:16 llm_engine.py:773] Finished liquid for 4 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.86s, update worker latency: 0.00s, liquid model weights latency: 0.33s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.36s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.891 GB, free space: 2.265GB, frag space: 0.587GB, current gpu block: #3208
INFO 09-18 07:17:16 llm_engine.py:759] ---------Start 5'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:17:16 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:17:16 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.893 GB, free space: 2.263GB, frag space: 0.589GB, [(898899, 21.39453125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:16 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:16 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:16 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.29s to send model shards
INFO 09-18 07:17:16 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 9.91GB/s
INFO 09-18 07:17:16 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.207 GB, reserved space on GPU 0: 16.816 GB, free space: 5.339GB, frag space: 0.609GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:16 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:17 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.27GB, sent bw: 14.75GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:17 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.887 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.090GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:17 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.887 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.287GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:17 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.887 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.132GB
INFO 09-18 07:17:17 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:17:17 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.566 GB, free space: 11.589GB, frag space: 0.656GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:17:17 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:17:17 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.566 GB, free space: 11.589GB, frag space: 0.656GB, [(898899, 12.068359375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:17 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:17 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:17 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.58s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:17 worker.py:152] send weights shards takes: 0.61s, sent out: 3.10GB, sent bw: 5.05GB/s
INFO 09-18 07:17:17 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.566 GB, free space: 11.589GB, frag space: 0.656GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:17 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:18 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.27GB, sent bw: 15.24GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:18 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.887 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.090GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:18 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.887 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.287GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:18 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.887 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.132GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:18 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:17:18 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.566 GB, free space: 11.589GB, frag space: 0.656GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:18 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #7929
INFO 09-18 07:17:18 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:18 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:18 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:18 worker.py:202] extend gpu in worker takes: 0.40s
INFO 09-18 07:17:18 llm_engine.py:773] Finished liquid for 5 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.46s, update worker latency: 0.01s, liquid model weights latency: 1.54s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.41s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.145 GB, reserved space on GPU 0: 19.754 GB, free space: 2.402GB, frag space: 0.609GB, current gpu block: #7929
INFO 09-18 07:17:18 llm_engine.py:759] ---------Start 6'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:17:18 multiproc_gpu_executor.py:242] Shrink to: #3208, currently using blocks: #1
INFO 09-18 07:17:18 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.145 GB, reserved space on GPU 0: 19.756 GB, free space: 2.400GB, frag space: 0.611GB
INFO 09-18 07:17:19 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.566 GB, free space: 11.589GB, frag space: 0.656GB
INFO 09-18 07:17:19 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:17:19 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.566 GB, free space: 11.589GB, frag space: 0.656GB, [(898899, 12.068359375)]
INFO 09-18 07:17:19 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.566 GB, free space: 11.589GB, frag space: 0.656GB
INFO 09-18 07:17:19 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 13.270 GB, free space: 8.886GB, frag space: 0.263GB
INFO 09-18 07:17:19 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 16.244 GB, free space: 5.912GB, frag space: 3.237GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:19 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.38GB/s
INFO 09-18 07:17:19 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 16.244 GB, free space: 5.912GB, frag space: 3.237GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:19 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 16.244 GB, free space: 5.912GB, frag space: 3.237GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:20 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.27GB, sent bw: 13.60GB/s
INFO 09-18 07:17:20 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.272 GB, reserved space on GPU 0: 19.689 GB, free space: 2.466GB, frag space: 0.417GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:20 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:17:20 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 20.416 GB, free space: 1.740GB, frag space: 1.112GB
INFO 09-18 07:17:20 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.627 GB, free space: 2.529GB, frag space: 0.323GB
INFO 09-18 07:17:20 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.627 GB, free space: 2.529GB, frag space: 0.323GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:20 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:17:20 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.627 GB, free space: 2.529GB, frag space: 0.323GB, [(898899, 21.12890625)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:20 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.910 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.222GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:20 worker.py:152] send weights shards takes: 0.26s, sent out: 3.10GB, sent bw: 11.94GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:20 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.007 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.302GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:20 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.007 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.104GB
INFO 09-18 07:17:20 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.627 GB, free space: 2.529GB, frag space: 0.323GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:20 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.007 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.104GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:21 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.27GB, sent bw: 14.90GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:21 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.272 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.241GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:21 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:21 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.936GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:21 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.147GB
INFO 09-18 07:17:21 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.627 GB, free space: 2.529GB, frag space: 0.323GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:17:21 llm_engine.py:773] Finished liquid for 6 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.56s, move and shrink latency: -1726640238.98s, update worker latency: 1726640238.99s, liquid model weights latency: 1.83s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.627 GB, free space: 2.529GB, frag space: 0.323GB, current gpu block: #3208
INFO 09-18 07:17:21 llm_engine.py:759] ---------Start 7'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:17:21 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #1
INFO 09-18 07:17:21 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.629 GB, free space: 2.527GB, frag space: 0.325GB
INFO 09-18 07:17:21 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.877 GB, free space: 11.279GB, frag space: 0.370GB
INFO 09-18 07:17:21 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:17:21 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.877 GB, free space: 11.279GB, frag space: 0.370GB, [(898899, 12.37890625)]
INFO 09-18 07:17:21 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.877 GB, free space: 11.279GB, frag space: 0.370GB
INFO 09-18 07:17:22 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.898 GB, free space: 5.257GB, frag space: 0.199GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:22 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.57GB/s
INFO 09-18 07:17:22 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.627 GB, free space: 1.529GB, frag space: 3.926GB
INFO 09-18 07:17:22 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.627 GB, free space: 1.529GB, frag space: 3.926GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:17:22 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.627 GB, free space: 1.529GB, frag space: 3.926GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:22 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.93GB/s
INFO 09-18 07:17:22 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.544GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:22 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:17:22 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.424 GB, free space: 0.732GB, frag space: 0.926GB
INFO 09-18 07:17:22 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB
INFO 09-18 07:17:22 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:17:22 llm_engine.py:773] Finished liquid for 7 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.29s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.66s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB, current gpu block: #964
INFO 09-18 07:17:22 llm_engine.py:759] ---------Start 8'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:17:22 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:17:22 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.949 GB, free space: 1.207GB, frag space: 0.452GB, [(898899, 22.451171875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:22 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:23 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:23 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.22s to send model shards
INFO 09-18 07:17:23 worker.py:152] send weights shards takes: 0.26s, sent out: 6.19GB, sent bw: 23.45GB/s
INFO 09-18 07:17:23 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.906 GB, free space: 7.250GB, frag space: 0.603GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:23 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:17:23 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.87GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:23 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:23 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:23 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:17:23 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:17:23 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.037 GB, free space: 11.119GB, frag space: 0.530GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2240
INFO 09-18 07:17:23 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3204
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:23 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:17:23 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:17:23 llm_engine.py:773] Finished liquid for 8 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.87s, update worker latency: 0.00s, liquid model weights latency: 0.33s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.906 GB, free space: 2.250GB, frag space: 0.649GB, current gpu block: #3204
INFO 09-18 07:17:23 llm_engine.py:759] ---------Start 9'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:17:23 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:17:23 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.908 GB, free space: 2.248GB, frag space: 0.651GB, [(898899, 21.41015625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:23 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:24 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:24 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.26s to send model shards
INFO 09-18 07:17:24 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 11.02GB/s
INFO 09-18 07:17:24 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.160 GB, reserved space on GPU 0: 16.582 GB, free space: 5.574GB, frag space: 0.422GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:24 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:24 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.26GB, sent bw: 14.81GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:24 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.097GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:24 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.295GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:24 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.140GB
INFO 09-18 07:17:24 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:17:24 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.332 GB, free space: 11.824GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:17:24 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:17:24 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.332 GB, free space: 11.824GB, frag space: 0.429GB, [(898899, 11.833984375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:24 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:25 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:25 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.59s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:25 worker.py:152] send weights shards takes: 0.62s, sent out: 3.10GB, sent bw: 4.98GB/s
INFO 09-18 07:17:25 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.332 GB, free space: 11.824GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:25 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:25 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.26GB, sent bw: 15.19GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:25 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:25 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.295GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:25 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.140GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:25 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:17:25 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.332 GB, free space: 11.824GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:25 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8045
INFO 09-18 07:17:26 worker.py:202] extend gpu in worker takes: 0.36s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:26 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:26 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:26 worker.py:202] extend gpu in worker takes: 0.39s
INFO 09-18 07:17:26 llm_engine.py:773] Finished liquid for 9 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.42s, update worker latency: 0.01s, liquid model weights latency: 1.52s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.39s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.358 GB, reserved space on GPU 0: 19.770 GB, free space: 2.386GB, frag space: 0.412GB, current gpu block: #8045
INFO 09-18 07:17:26 llm_engine.py:759] ---------Start 10'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:17:26 multiproc_gpu_executor.py:242] Shrink to: #3204, currently using blocks: #1
INFO 09-18 07:17:26 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.358 GB, reserved space on GPU 0: 19.771 GB, free space: 2.384GB, frag space: 0.414GB
INFO 09-18 07:17:26 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.332 GB, free space: 11.824GB, frag space: 0.429GB
INFO 09-18 07:17:26 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:17:26 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.332 GB, free space: 11.824GB, frag space: 0.429GB, [(898899, 11.833984375)]
INFO 09-18 07:17:26 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.332 GB, free space: 11.824GB, frag space: 0.429GB
INFO 09-18 07:17:26 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 13.285 GB, free space: 8.871GB, frag space: 0.286GB
INFO 09-18 07:17:26 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.432 GB, free space: 5.724GB, frag space: 3.433GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.34s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:26 worker.py:152] send weights shards takes: 0.36s, sent out: 3.10GB, sent bw: 8.51GB/s
INFO 09-18 07:17:26 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.432 GB, free space: 5.724GB, frag space: 3.433GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:26 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.432 GB, free space: 5.724GB, frag space: 3.433GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:27 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.26GB, sent bw: 13.59GB/s
INFO 09-18 07:17:27 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.756 GB, free space: 2.400GB, frag space: 0.499GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:27 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:17:27 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 20.482 GB, free space: 1.673GB, frag space: 1.226GB
INFO 09-18 07:17:27 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.436GB
INFO 09-18 07:17:27 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.436GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:27 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:17:27 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.436GB, [(898899, 21.1953125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:27 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.903 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.230GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:28 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.310GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:28 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.112GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:28 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.68GB/s
INFO 09-18 07:17:28 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.436GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:28 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.112GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:28 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.26GB, sent bw: 15.07GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:28 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.257GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:28 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:28 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.983GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:28 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.194GB
INFO 09-18 07:17:28 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.436GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:17:28 llm_engine.py:773] Finished liquid for 10 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.61s, move and shrink latency: -1726640246.28s, update worker latency: 1726640246.28s, liquid model weights latency: 1.89s, init mem latency: 0.00s, liquid kvc latency: 0.71s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.436GB, current gpu block: #3204
INFO 09-18 07:17:28 llm_engine.py:759] ---------Start 11'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:17:28 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #1
INFO 09-18 07:17:28 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.695 GB, free space: 2.461GB, frag space: 0.438GB
INFO 09-18 07:17:29 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.943 GB, free space: 11.213GB, frag space: 0.436GB
INFO 09-18 07:17:29 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:17:29 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.943 GB, free space: 11.213GB, frag space: 0.436GB, [(898899, 12.4453125)]
INFO 09-18 07:17:29 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.943 GB, free space: 11.213GB, frag space: 0.436GB
INFO 09-18 07:17:29 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.902 GB, free space: 5.254GB, frag space: 0.203GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:29 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.61GB/s
INFO 09-18 07:17:29 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.912 GB, free space: 1.244GB, frag space: 4.212GB
INFO 09-18 07:17:29 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.912 GB, free space: 1.244GB, frag space: 4.212GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:17:29 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.912 GB, free space: 1.244GB, frag space: 4.212GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:29 cache_engine.py:159] send kvc shards takes: 0.20s, sent out: 3.77GB, sent bw: 19.11GB/s
INFO 09-18 07:17:29 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.029 GB, free space: 1.127GB, frag space: 0.563GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:17:30 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.920 GB, free space: 0.236GB, frag space: 1.422GB
INFO 09-18 07:17:30 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.967 GB, free space: 1.189GB, frag space: 0.469GB
INFO 09-18 07:17:30 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.967 GB, free space: 1.189GB, frag space: 0.469GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:17:30 llm_engine.py:773] Finished liquid for 11 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.31s, move and shrink latency: 0.12s, update worker latency: -0.11s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.68s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.967 GB, free space: 1.189GB, frag space: 0.469GB, current gpu block: #964
INFO 09-18 07:17:30 llm_engine.py:759] ---------Start 12'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:17:30 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:17:30 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.969 GB, free space: 1.187GB, frag space: 0.471GB, [(898899, 22.470703125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.26s to send model shards
INFO 09-18 07:17:30 worker.py:152] send weights shards takes: 0.31s, sent out: 6.19GB, sent bw: 20.23GB/s
INFO 09-18 07:17:30 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.922 GB, free space: 7.234GB, frag space: 0.618GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
INFO 09-18 07:17:30 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.54GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:30 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:17:30 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:17:30 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.053 GB, free space: 11.103GB, frag space: 0.546GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2236
INFO 09-18 07:17:30 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3200
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:31 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:17:31 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:17:31 llm_engine.py:773] Finished liquid for 12 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.87s, update worker latency: 0.00s, liquid model weights latency: 0.35s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.37s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.859 GB, free space: 2.297GB, frag space: 0.618GB, current gpu block: #3200
INFO 09-18 07:17:31 llm_engine.py:759] ---------Start 13'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:17:31 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:17:31 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.861 GB, free space: 2.295GB, frag space: 0.620GB, [(898899, 21.36328125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:31 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
It takes: 0.28s to send model shards
INFO 09-18 07:17:31 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 9.98GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:31 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:31 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:31 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.145 GB, reserved space on GPU 0: 16.660 GB, free space: 5.496GB, frag space: 0.515GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:31 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:31 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.25GB, sent bw: 14.83GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:31 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:31 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:32 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
INFO 09-18 07:17:32 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:17:32 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.410 GB, free space: 11.746GB, frag space: 0.515GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
INFO 09-18 07:17:32 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:17:32 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.410 GB, free space: 11.746GB, frag space: 0.515GB, [(898899, 11.912109375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:32 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:32 worker.py:152] send weights shards takes: 0.26s, sent out: 3.10GB, sent bw: 11.71GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:32 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:32 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:32 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.410 GB, free space: 11.746GB, frag space: 0.515GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.721GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:32 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:33 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.25GB, sent bw: 15.22GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:33 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:33 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:33 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:33 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:17:33 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.410 GB, free space: 11.746GB, frag space: 0.515GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:17:33 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8001
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:33 worker.py:202] extend gpu in worker takes: 0.39s
INFO 09-18 07:17:33 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:33 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:33 worker.py:202] extend gpu in worker takes: 0.40s
INFO 09-18 07:17:33 llm_engine.py:773] Finished liquid for 13 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.50s, update worker latency: 0.01s, liquid model weights latency: 1.59s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.40s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.272 GB, reserved space on GPU 0: 19.848 GB, free space: 2.308GB, frag space: 0.576GB, current gpu block: #8001
INFO 09-18 07:17:33 llm_engine.py:759] ---------Start 14'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:17:33 multiproc_gpu_executor.py:242] Shrink to: #3200, currently using blocks: #2
INFO 09-18 07:17:33 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.272 GB, reserved space on GPU 0: 19.850 GB, free space: 2.306GB, frag space: 0.578GB
INFO 09-18 07:17:33 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.410 GB, free space: 11.746GB, frag space: 0.515GB
INFO 09-18 07:17:33 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:17:33 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.410 GB, free space: 11.746GB, frag space: 0.515GB, [(898899, 11.912109375)]
INFO 09-18 07:17:33 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.410 GB, free space: 11.746GB, frag space: 0.515GB
INFO 09-18 07:17:34 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 13.215 GB, free space: 8.941GB, frag space: 0.224GB
INFO 09-18 07:17:34 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.361 GB, free space: 5.795GB, frag space: 3.370GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.34s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:34 worker.py:152] send weights shards takes: 0.36s, sent out: 3.10GB, sent bw: 8.52GB/s
INFO 09-18 07:17:34 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.361 GB, free space: 5.795GB, frag space: 3.370GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:17:34 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.361 GB, free space: 5.795GB, frag space: 3.370GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:34 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.25GB, sent bw: 14.15GB/s
INFO 09-18 07:17:34 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.709 GB, free space: 2.447GB, frag space: 0.468GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:34 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:17:35 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 20.490 GB, free space: 1.666GB, frag space: 1.249GB
INFO 09-18 07:17:35 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.709 GB, free space: 2.447GB, frag space: 0.468GB
INFO 09-18 07:17:35 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.709 GB, free space: 2.447GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:17:35 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:17:35 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.709 GB, free space: 2.447GB, frag space: 0.468GB, [(898899, 21.2109375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:35 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.895 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:35 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:35 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:35 worker.py:152] send weights shards takes: 0.26s, sent out: 3.10GB, sent bw: 11.76GB/s
INFO 09-18 07:17:35 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.709 GB, free space: 2.447GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:35 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:35 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.25GB, sent bw: 14.77GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:35 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:35 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:36 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 20.170 GB, free space: 1.872GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:36 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
INFO 09-18 07:17:36 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.709 GB, free space: 2.447GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.653GB, frag space: 0.000GB
INFO 09-18 07:17:36 llm_engine.py:773] Finished liquid for 14 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.55s, move and shrink latency: -1726640253.74s, update worker latency: 1726640253.74s, liquid model weights latency: 1.81s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.709 GB, free space: 2.447GB, frag space: 0.468GB, current gpu block: #3200
INFO 09-18 07:17:36 llm_engine.py:759] ---------Start 15'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:17:36 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #2
INFO 09-18 07:17:36 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.711 GB, free space: 2.445GB, frag space: 0.470GB
INFO 09-18 07:17:36 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB
INFO 09-18 07:17:36 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:17:36 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB, [(898899, 12.5234375)]
INFO 09-18 07:17:36 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB
INFO 09-18 07:17:36 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.918 GB, free space: 5.238GB, frag space: 0.218GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:36 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 17.29GB/s
INFO 09-18 07:17:36 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.896 GB, free space: 1.259GB, frag space: 4.196GB
INFO 09-18 07:17:36 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.896 GB, free space: 1.259GB, frag space: 4.196GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:17:36 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.896 GB, free space: 1.259GB, frag space: 4.196GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:37 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.50GB/s
INFO 09-18 07:17:37 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.088 GB, free space: 1.068GB, frag space: 0.622GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:37 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:17:37 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.979 GB, free space: 0.177GB, frag space: 1.481GB
INFO 09-18 07:17:37 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.025 GB, free space: 1.130GB, frag space: 0.528GB
INFO 09-18 07:17:37 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.025 GB, free space: 1.130GB, frag space: 0.528GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:17:37 llm_engine.py:773] Finished liquid for 15 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.30s, move and shrink latency: 0.10s, update worker latency: -0.10s, liquid model weights latency: 0.61s, init mem latency: 0.00s, liquid kvc latency: 0.69s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.025 GB, free space: 1.130GB, frag space: 0.528GB, current gpu block: #964
INFO 09-18 07:17:37 llm_engine.py:759] ---------Start 16'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:17:37 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:17:37 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.027 GB, free space: 1.129GB, frag space: 0.530GB, [(898899, 22.529296875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:37 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:37 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:37 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.26s to send model shards
INFO 09-18 07:17:38 worker.py:152] send weights shards takes: 0.31s, sent out: 6.19GB, sent bw: 20.26GB/s
INFO 09-18 07:17:38 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 15.047 GB, free space: 7.109GB, frag space: 0.743GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:38 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:17:38 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.72GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:38 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:38 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:38 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:17:38 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:17:38 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.178 GB, free space: 10.978GB, frag space: 0.671GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2204
INFO 09-18 07:17:38 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3168
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:38 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:17:38 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:17:38 llm_engine.py:773] Finished liquid for 16 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.87s, update worker latency: 0.00s, liquid model weights latency: 0.34s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.36s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.859 GB, free space: 2.297GB, frag space: 0.743GB, current gpu block: #3168
INFO 09-18 07:17:38 llm_engine.py:759] ---------Start 17'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:17:38 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:17:38 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.861 GB, free space: 2.295GB, frag space: 0.745GB, [(898899, 21.36328125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:38 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:38 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:38 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.24s to send model shards
INFO 09-18 07:17:38 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.54GB/s
INFO 09-18 07:17:38 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.020 GB, reserved space on GPU 0: 16.379 GB, free space: 5.777GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.860GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:38 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:39 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.809 GB, reserved space on GPU 2: 10.852 GB, free space: 11.687GB, frag space: 1.043GB
INFO 09-18 07:17:39 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.19GB, sent bw: 14.76GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:39 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.809 GB, reserved space on GPU 2: 11.045 GB, free space: 11.494GB, frag space: 1.236GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:39 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.809 GB, reserved space on GPU 2: 9.895 GB, free space: 12.644GB, frag space: 0.086GB
INFO 09-18 07:17:39 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:17:39 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.860GB, frag space: 0.000GB
INFO 09-18 07:17:39 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:17:39 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.359GB, [(898899, 11.693359375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:39 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:39 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:39 worker.py:152] send weights shards takes: 0.47s, sent out: 3.10GB, sent bw: 6.63GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:39 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:39 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.846GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:39 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:40 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.19GB, sent bw: 15.14GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:40 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.809 GB, reserved space on GPU 3: 10.852 GB, free space: 11.687GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:40 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.809 GB, reserved space on GPU 3: 11.045 GB, free space: 11.494GB, frag space: 1.236GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:40 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.809 GB, reserved space on GPU 3: 9.895 GB, free space: 12.644GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:40 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:17:40 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 12.034GB, frag space: 0.000GB
INFO 09-18 07:17:40 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8081
INFO 09-18 07:17:40 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:40 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:40 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:40 worker.py:202] extend gpu in worker takes: 0.41s
INFO 09-18 07:17:40 llm_engine.py:773] Finished liquid for 17 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.31s, update worker latency: 0.01s, liquid model weights latency: 1.34s, init mem latency: 0.00s, liquid kvc latency: 0.48s, extending gpu blocks latency: 0.41s, update blocks latency: 0.07s;, current mem info on GPU0: allocated space on GPU 0: 19.457 GB, reserved space on GPU 0: 19.816 GB, free space: 2.339GB, frag space: 0.359GB, current gpu block: #8081
INFO 09-18 07:17:40 llm_engine.py:759] ---------Start 18'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:17:40 multiproc_gpu_executor.py:242] Shrink to: #3168, currently using blocks: #2
INFO 09-18 07:17:40 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.457 GB, reserved space on GPU 0: 19.818 GB, free space: 2.338GB, frag space: 0.361GB
INFO 09-18 07:17:41 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.359GB
INFO 09-18 07:17:41 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:17:41 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.359GB, [(898899, 11.693359375)]
INFO 09-18 07:17:41 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.359GB
INFO 09-18 07:17:41 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 13.164 GB, free space: 8.992GB, frag space: 0.235GB
INFO 09-18 07:17:41 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 16.404 GB, free space: 5.752GB, frag space: 3.476GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:41 worker.py:152] send weights shards takes: 0.36s, sent out: 3.10GB, sent bw: 8.72GB/s
INFO 09-18 07:17:41 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 16.404 GB, free space: 5.752GB, frag space: 3.476GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 12.034GB, frag space: 0.000GB
INFO 09-18 07:17:41 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 16.404 GB, free space: 5.752GB, frag space: 3.476GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:41 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.19GB, sent bw: 14.08GB/s
INFO 09-18 07:17:41 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.468GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:41 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:17:42 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 20.357 GB, free space: 1.798GB, frag space: 1.241GB
INFO 09-18 07:17:42 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.468GB
INFO 09-18 07:17:42 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 12.034GB, frag space: 0.000GB
INFO 09-18 07:17:42 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:17:42 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.468GB, [(898899, 21.0859375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:42 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.832 GB, reserved space on GPU 1: 10.008 GB, free space: 12.034GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:42 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.929 GB, reserved space on GPU 1: 13.184 GB, free space: 8.858GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:42 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.929 GB, reserved space on GPU 1: 15.986 GB, free space: 6.055GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:42 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.60GB/s
INFO 09-18 07:17:42 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 6.055GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:42 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.929 GB, reserved space on GPU 1: 15.986 GB, free space: 6.055GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:43 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.19GB, sent bw: 14.96GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:43 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.116 GB, reserved space on GPU 1: 19.264 GB, free space: 2.778GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:43 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:43 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.116 GB, reserved space on GPU 1: 20.811 GB, free space: 1.231GB, frag space: 1.694GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:43 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.116 GB, reserved space on GPU 1: 19.264 GB, free space: 2.778GB, frag space: 0.147GB
INFO 09-18 07:17:43 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.778GB, frag space: 0.000GB
INFO 09-18 07:17:43 llm_engine.py:773] Finished liquid for 18 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.71s, move and shrink latency: -1726640260.92s, update worker latency: 1726640260.93s, liquid model weights latency: 2.00s, init mem latency: 0.00s, liquid kvc latency: 0.70s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.468GB, current gpu block: #3168
INFO 09-18 07:17:43 llm_engine.py:759] ---------Start 19'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:17:43 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #2
INFO 09-18 07:17:43 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.586 GB, free space: 2.570GB, frag space: 0.470GB
INFO 09-18 07:17:43 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB
INFO 09-18 07:17:43 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:17:43 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB, [(898899, 12.5234375)]
INFO 09-18 07:17:43 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB
INFO 09-18 07:17:44 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.902 GB, free space: 5.254GB, frag space: 0.203GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:44 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.53GB/s
INFO 09-18 07:17:44 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.100 GB, free space: 1.056GB, frag space: 4.399GB
INFO 09-18 07:17:44 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.100 GB, free space: 1.056GB, frag space: 4.399GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:17:44 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.100 GB, free space: 1.056GB, frag space: 4.399GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:44 cache_engine.py:159] send kvc shards takes: 0.20s, sent out: 3.77GB, sent bw: 18.96GB/s
INFO 09-18 07:17:44 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.575GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:44 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:17:45 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.932 GB, free space: 0.224GB, frag space: 1.434GB
INFO 09-18 07:17:45 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB
INFO 09-18 07:17:45 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:17:45 llm_engine.py:773] Finished liquid for 19 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.36s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.61s, init mem latency: 0.00s, liquid kvc latency: 0.74s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, current gpu block: #964
INFO 09-18 07:17:45 llm_engine.py:759] ---------Start 20'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:17:45 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:17:45 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.980 GB, free space: 1.175GB, frag space: 0.483GB, [(898899, 22.482421875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.22s to send model shards
INFO 09-18 07:17:45 worker.py:152] send weights shards takes: 0.26s, sent out: 6.19GB, sent bw: 23.41GB/s
INFO 09-18 07:17:45 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.875 GB, free space: 7.281GB, frag space: 0.571GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:17:45 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.53GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:17:45 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:17:45 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.006 GB, free space: 11.150GB, frag space: 0.499GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2248
INFO 09-18 07:17:45 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3212
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:45 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:17:45 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:17:45 llm_engine.py:773] Finished liquid for 20 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.84s, update worker latency: 0.00s, liquid model weights latency: 0.30s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.571GB, current gpu block: #3212
INFO 09-18 07:17:45 llm_engine.py:759] ---------Start 21'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:17:45 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:17:46 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.573GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:46 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:46 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:46 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.26s to send model shards
INFO 09-18 07:17:46 worker.py:152] send weights shards takes: 0.29s, sent out: 3.10GB, sent bw: 10.70GB/s
INFO 09-18 07:17:46 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.207 GB, reserved space on GPU 0: 16.629 GB, free space: 5.527GB, frag space: 0.422GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:46 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:46 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.27GB, sent bw: 14.77GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:46 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:46 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.279GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:46 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.125GB
INFO 09-18 07:17:46 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:17:46 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:17:46 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:17:46 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, [(898899, 11.880859375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:46 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:47 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:47 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.25s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:47 worker.py:152] send weights shards takes: 0.48s, sent out: 3.10GB, sent bw: 6.45GB/s
INFO 09-18 07:17:47 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:47 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:47 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.27GB, sent bw: 15.23GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:47 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:47 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.279GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:47 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.125GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:47 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:17:47 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:47 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8029
INFO 09-18 07:17:48 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:48 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:48 worker.py:202] extend gpu in worker takes: 0.41s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:48 worker.py:202] extend gpu in worker takes: 0.41s
INFO 09-18 07:17:48 llm_engine.py:773] Finished liquid for 21 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.39s, update worker latency: 0.01s, liquid model weights latency: 1.47s, init mem latency: 0.00s, liquid kvc latency: 0.49s, extending gpu blocks latency: 0.42s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.332 GB, reserved space on GPU 0: 19.754 GB, free space: 2.402GB, frag space: 0.422GB, current gpu block: #8029
INFO 09-18 07:17:48 llm_engine.py:759] ---------Start 22'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:17:48 multiproc_gpu_executor.py:242] Shrink to: #3212, currently using blocks: #2
INFO 09-18 07:17:48 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.332 GB, reserved space on GPU 0: 19.756 GB, free space: 2.400GB, frag space: 0.423GB
INFO 09-18 07:17:48 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB
INFO 09-18 07:17:48 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:17:48 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, [(898899, 11.880859375)]
INFO 09-18 07:17:48 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB
INFO 09-18 07:17:48 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 13.285 GB, free space: 8.871GB, frag space: 0.270GB
INFO 09-18 07:17:48 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.416 GB, free space: 5.740GB, frag space: 3.401GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:48 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.28GB/s
INFO 09-18 07:17:48 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.416 GB, free space: 5.740GB, frag space: 3.401GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:48 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.416 GB, free space: 5.740GB, frag space: 3.401GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:49 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.27GB, sent bw: 14.07GB/s
INFO 09-18 07:17:49 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.288 GB, reserved space on GPU 0: 19.732 GB, free space: 2.423GB, frag space: 0.444GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:49 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:17:50 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 20.459 GB, free space: 1.697GB, frag space: 1.155GB
INFO 09-18 07:17:50 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.670 GB, free space: 2.486GB, frag space: 0.366GB
INFO 09-18 07:17:50 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.670 GB, free space: 2.486GB, frag space: 0.366GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:17:50 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:17:50 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.670 GB, free space: 2.486GB, frag space: 0.366GB, [(898899, 21.171875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:50 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.918 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.215GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:50 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.294GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:50 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:50 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 10.90GB/s
INFO 09-18 07:17:50 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.670 GB, free space: 2.486GB, frag space: 0.366GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:50 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:50 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.27GB, sent bw: 14.92GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:50 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.288 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.226GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:50 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:51 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.936GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:51 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.147GB
INFO 09-18 07:17:51 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.670 GB, free space: 2.486GB, frag space: 0.366GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:17:51 llm_engine.py:773] Finished liquid for 22 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.78s, move and shrink latency: -1726640268.38s, update worker latency: 1726640268.39s, liquid model weights latency: 2.04s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.670 GB, free space: 2.486GB, frag space: 0.366GB, current gpu block: #3212
INFO 09-18 07:17:51 llm_engine.py:759] ---------Start 23'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:17:51 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #2
INFO 09-18 07:17:51 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.672 GB, free space: 2.484GB, frag space: 0.368GB
INFO 09-18 07:17:51 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.920 GB, free space: 11.236GB, frag space: 0.413GB
INFO 09-18 07:17:51 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:17:51 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.920 GB, free space: 11.236GB, frag space: 0.413GB, [(898899, 12.421875)]
INFO 09-18 07:17:51 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.920 GB, free space: 11.236GB, frag space: 0.413GB
INFO 09-18 07:17:51 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.895 GB, free space: 5.261GB, frag space: 0.195GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:51 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.62GB/s
INFO 09-18 07:17:51 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.592 GB, free space: 1.564GB, frag space: 3.891GB
INFO 09-18 07:17:51 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.592 GB, free space: 1.564GB, frag space: 3.891GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:17:51 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.592 GB, free space: 1.564GB, frag space: 3.891GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:52 cache_engine.py:159] send kvc shards takes: 0.18s, sent out: 3.77GB, sent bw: 20.92GB/s
INFO 09-18 07:17:52 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.062 GB, free space: 1.093GB, frag space: 0.596GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:52 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:17:52 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.947 GB, free space: 0.209GB, frag space: 1.450GB
INFO 09-18 07:17:52 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB
INFO 09-18 07:17:52 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:17:52 llm_engine.py:773] Finished liquid for 23 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.35s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB, current gpu block: #964
INFO 09-18 07:17:52 llm_engine.py:759] ---------Start 24'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:17:52 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:17:52 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.996 GB, free space: 1.160GB, frag space: 0.499GB, [(898899, 22.498046875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:52 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:52 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:52 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.24s to send model shards
INFO 09-18 07:17:52 worker.py:152] send weights shards takes: 0.29s, sent out: 6.19GB, sent bw: 21.59GB/s
INFO 09-18 07:17:52 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 15.016 GB, free space: 7.140GB, frag space: 0.712GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:52 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:17:53 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.65GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:53 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:53 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:53 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:17:53 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:17:53 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.146 GB, free space: 11.009GB, frag space: 0.640GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2212
INFO 09-18 07:17:53 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3176
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:53 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:17:53 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:17:53 llm_engine.py:773] Finished liquid for 24 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.87s, update worker latency: 0.00s, liquid model weights latency: 0.34s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.37s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.891 GB, free space: 2.265GB, frag space: 0.712GB, current gpu block: #3176
INFO 09-18 07:17:53 llm_engine.py:759] ---------Start 25'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:17:53 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:17:53 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.893 GB, free space: 2.263GB, frag space: 0.714GB, [(898899, 21.39453125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:53 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:53 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:53 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.27s to send model shards
INFO 09-18 07:17:53 worker.py:152] send weights shards takes: 0.30s, sent out: 3.10GB, sent bw: 10.34GB/s
INFO 09-18 07:17:53 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.082 GB, reserved space on GPU 0: 16.488 GB, free space: 5.668GB, frag space: 0.406GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:53 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:17:54 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.20GB, sent bw: 14.77GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:54 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.825 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.090GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:54 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.825 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.285GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:54 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.825 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.132GB
INFO 09-18 07:17:54 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:17:54 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.848 GB, reserved space on GPU 0: 10.301 GB, free space: 11.855GB, frag space: 0.453GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
INFO 09-18 07:17:54 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:17:54 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.848 GB, reserved space on GPU 0: 10.301 GB, free space: 11.855GB, frag space: 0.453GB, [(898899, 11.802734375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:54 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:55 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:55 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.57s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:55 worker.py:152] send weights shards takes: 0.60s, sent out: 3.10GB, sent bw: 5.20GB/s
INFO 09-18 07:17:55 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.848 GB, reserved space on GPU 0: 10.301 GB, free space: 11.855GB, frag space: 0.453GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.784GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:55 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:55 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.20GB, sent bw: 15.20GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:55 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.825 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.090GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:55 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.825 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.285GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:55 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.825 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.132GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:55 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:17:55 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.848 GB, reserved space on GPU 0: 10.301 GB, free space: 11.855GB, frag space: 0.453GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:17:55 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8033
INFO 09-18 07:17:55 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:55 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:55 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:55 worker.py:202] extend gpu in worker takes: 0.40s
INFO 09-18 07:17:55 llm_engine.py:773] Finished liquid for 25 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.46s, update worker latency: 0.01s, liquid model weights latency: 1.55s, init mem latency: 0.00s, liquid kvc latency: 0.49s, extending gpu blocks latency: 0.41s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.334 GB, reserved space on GPU 0: 19.801 GB, free space: 2.355GB, frag space: 0.466GB, current gpu block: #8033
INFO 09-18 07:17:55 llm_engine.py:759] ---------Start 26'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:17:56 multiproc_gpu_executor.py:242] Shrink to: #3176, currently using blocks: #2
INFO 09-18 07:17:56 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.334 GB, reserved space on GPU 0: 19.803 GB, free space: 2.353GB, frag space: 0.468GB
INFO 09-18 07:17:56 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.848 GB, reserved space on GPU 0: 10.301 GB, free space: 11.855GB, frag space: 0.453GB
INFO 09-18 07:17:56 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:17:56 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.848 GB, reserved space on GPU 0: 10.301 GB, free space: 11.855GB, frag space: 0.453GB, [(898899, 11.802734375)]
INFO 09-18 07:17:56 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.848 GB, reserved space on GPU 0: 10.301 GB, free space: 11.855GB, frag space: 0.453GB
INFO 09-18 07:17:56 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.944 GB, reserved space on GPU 0: 13.227 GB, free space: 8.929GB, frag space: 0.282GB
INFO 09-18 07:17:56 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.944 GB, reserved space on GPU 0: 16.326 GB, free space: 5.830GB, frag space: 3.382GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:56 worker.py:152] send weights shards takes: 0.35s, sent out: 3.10GB, sent bw: 8.88GB/s
INFO 09-18 07:17:56 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.944 GB, reserved space on GPU 0: 16.326 GB, free space: 5.830GB, frag space: 3.382GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:17:56 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.944 GB, reserved space on GPU 0: 16.326 GB, free space: 5.830GB, frag space: 3.382GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:57 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.20GB, sent bw: 14.01GB/s
INFO 09-18 07:17:57 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.147 GB, reserved space on GPU 0: 19.498 GB, free space: 2.658GB, frag space: 0.351GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:17:57 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:17:57 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 20.217 GB, free space: 1.939GB, frag space: 1.038GB
INFO 09-18 07:17:57 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.436 GB, free space: 2.720GB, frag space: 0.257GB
INFO 09-18 07:17:57 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.436 GB, free space: 2.720GB, frag space: 0.257GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:17:57 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:17:57 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.436 GB, free space: 2.720GB, frag space: 0.257GB, [(898899, 20.9375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:57 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.848 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.222GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:57 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.944 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.302GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:57 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.944 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.104GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:57 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 10.92GB/s
INFO 09-18 07:17:57 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.436 GB, free space: 2.720GB, frag space: 0.257GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:57 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.944 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.104GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:58 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.20GB, sent bw: 14.85GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:58 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.147 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.241GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:17:58 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:58 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 20.107 GB, free space: 1.934GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:58 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 19.326 GB, free space: 2.716GB, frag space: 0.147GB
INFO 09-18 07:17:58 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.436 GB, free space: 2.720GB, frag space: 0.257GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.716GB, frag space: 0.000GB
INFO 09-18 07:17:58 llm_engine.py:773] Finished liquid for 26 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.63s, move and shrink latency: -1726640275.99s, update worker latency: 1726640276.00s, liquid model weights latency: 1.91s, init mem latency: 0.00s, liquid kvc latency: 0.71s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.436 GB, free space: 2.720GB, frag space: 0.257GB, current gpu block: #3176
INFO 09-18 07:17:58 llm_engine.py:759] ---------Start 27'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:17:58 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #2
INFO 09-18 07:17:58 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.438 GB, free space: 2.718GB, frag space: 0.259GB
INFO 09-18 07:17:58 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.811 GB, free space: 11.345GB, frag space: 0.304GB
INFO 09-18 07:17:58 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:17:58 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.811 GB, free space: 11.345GB, frag space: 0.304GB, [(898899, 12.3125)]
INFO 09-18 07:17:58 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.811 GB, free space: 11.345GB, frag space: 0.304GB
INFO 09-18 07:17:59 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.895 GB, free space: 5.261GB, frag space: 0.195GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:59 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.60GB/s
INFO 09-18 07:17:59 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.748 GB, free space: 1.408GB, frag space: 4.047GB
INFO 09-18 07:17:59 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.748 GB, free space: 1.408GB, frag space: 4.047GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:17:59 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.748 GB, free space: 1.408GB, frag space: 4.047GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:59 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.33GB/s
INFO 09-18 07:17:59 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.544GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:17:59 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:17:59 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.424 GB, free space: 0.732GB, frag space: 0.926GB
INFO 09-18 07:17:59 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB
INFO 09-18 07:17:59 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:17:59 llm_engine.py:773] Finished liquid for 27 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.30s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.67s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB, current gpu block: #964
INFO 09-18 07:18:00 llm_engine.py:759] ---------Start 28'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:00 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:00 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.949 GB, free space: 1.207GB, frag space: 0.452GB, [(898899, 22.451171875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.26s to send model shards
INFO 09-18 07:18:00 worker.py:152] send weights shards takes: 0.30s, sent out: 6.19GB, sent bw: 20.51GB/s
INFO 09-18 07:18:00 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.844 GB, free space: 7.312GB, frag space: 0.540GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:00 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.67GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:00 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:00 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.975 GB, free space: 11.181GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2256
INFO 09-18 07:18:00 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3220
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:00 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:18:00 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:18:00 llm_engine.py:773] Finished liquid for 28 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.89s, update worker latency: 0.00s, liquid model weights latency: 0.34s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.906 GB, free space: 2.250GB, frag space: 0.587GB, current gpu block: #3220
INFO 09-18 07:18:00 llm_engine.py:759] ---------Start 29'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:00 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:00 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.908 GB, free space: 2.248GB, frag space: 0.589GB, [(898899, 21.41015625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:00 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:01 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:01 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.29s to send model shards
INFO 09-18 07:18:01 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 9.95GB/s
INFO 09-18 07:18:01 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.223 GB, reserved space on GPU 0: 16.535 GB, free space: 5.621GB, frag space: 0.312GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.610GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:01 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:01 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.29GB, sent bw: 14.80GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:01 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:01 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.240GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:01 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.086GB
INFO 09-18 07:18:01 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:01 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.265GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.610GB, frag space: 0.000GB
INFO 09-18 07:18:01 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:02 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.265GB, [(898899, 11.724609375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:02 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:02 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:02 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:02 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.46GB/s
INFO 09-18 07:18:02 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.265GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.596GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:02 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:02 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.29GB, sent bw: 15.23GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:02 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:02 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.240GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:02 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:03 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:03 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.265GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:03 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8105
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:03 worker.py:202] extend gpu in worker takes: 0.42s
INFO 09-18 07:18:03 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:03 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:03 worker.py:202] extend gpu in worker takes: 0.43s
INFO 09-18 07:18:03 llm_engine.py:773] Finished liquid for 29 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.52s, update worker latency: 0.01s, liquid model weights latency: 1.56s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.44s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.475 GB, reserved space on GPU 0: 19.785 GB, free space: 2.371GB, frag space: 0.310GB, current gpu block: #8105
INFO 09-18 07:18:03 llm_engine.py:759] ---------Start 30'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:03 multiproc_gpu_executor.py:242] Shrink to: #3220, currently using blocks: #3
INFO 09-18 07:18:03 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.475 GB, reserved space on GPU 0: 19.787 GB, free space: 2.369GB, frag space: 0.312GB
INFO 09-18 07:18:03 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.265GB
INFO 09-18 07:18:03 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:03 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.265GB, [(898899, 11.724609375)]
INFO 09-18 07:18:03 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.265GB
INFO 09-18 07:18:04 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 13.297 GB, free space: 8.859GB, frag space: 0.243GB
INFO 09-18 07:18:04 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.553 GB, free space: 5.603GB, frag space: 3.499GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:04 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.33GB/s
INFO 09-18 07:18:04 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.553 GB, free space: 5.603GB, frag space: 3.499GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:04 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.553 GB, free space: 5.603GB, frag space: 3.499GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:04 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.29GB, sent bw: 13.75GB/s
INFO 09-18 07:18:04 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.838 GB, free space: 2.318GB, frag space: 0.472GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:04 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:05 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 20.627 GB, free space: 1.529GB, frag space: 1.308GB
INFO 09-18 07:18:05 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.838 GB, free space: 2.318GB, frag space: 0.519GB
INFO 09-18 07:18:05 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.838 GB, free space: 2.318GB, frag space: 0.519GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:05 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:05 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.838 GB, free space: 2.318GB, frag space: 0.519GB, [(898899, 21.33984375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:05 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.957 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:05 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:05 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:05 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 11.04GB/s
INFO 09-18 07:18:05 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.838 GB, free space: 2.318GB, frag space: 0.519GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:05 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:05 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.29GB, sent bw: 14.79GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:05 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.366 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:05 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:06 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.319 GB, reserved space on GPU 1: 20.303 GB, free space: 1.739GB, frag space: 0.983GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:06 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.319 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.194GB
INFO 09-18 07:18:06 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.838 GB, free space: 2.318GB, frag space: 0.519GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.528GB, frag space: 0.000GB
INFO 09-18 07:18:06 llm_engine.py:773] Finished liquid for 30 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.59s, move and shrink latency: -1726640283.50s, update worker latency: 1726640283.50s, liquid model weights latency: 1.86s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.838 GB, free space: 2.318GB, frag space: 0.519GB, current gpu block: #3220
INFO 09-18 07:18:06 llm_engine.py:759] ---------Start 31'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:06 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #3
INFO 09-18 07:18:06 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.840 GB, free space: 2.316GB, frag space: 0.520GB
INFO 09-18 07:18:06 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.025 GB, free space: 11.130GB, frag space: 0.519GB
INFO 09-18 07:18:06 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:06 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.025 GB, free space: 11.130GB, frag space: 0.519GB, [(898899, 12.52734375)]
INFO 09-18 07:18:06 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.025 GB, free space: 11.130GB, frag space: 0.519GB
INFO 09-18 07:18:06 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.906 GB, free space: 5.250GB, frag space: 0.207GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:06 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.69GB/s
INFO 09-18 07:18:06 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.885 GB, free space: 1.271GB, frag space: 4.184GB
INFO 09-18 07:18:06 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.885 GB, free space: 1.271GB, frag space: 4.184GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:06 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.885 GB, free space: 1.271GB, frag space: 4.184GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 cache_engine.py:159] send kvc shards takes: 0.51s, sent out: 3.77GB, sent bw: 7.40GB/s
INFO 09-18 07:18:07 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.029 GB, free space: 1.127GB, frag space: 0.563GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:07 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.920 GB, free space: 0.236GB, frag space: 1.422GB
INFO 09-18 07:18:07 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.967 GB, free space: 1.189GB, frag space: 0.469GB
INFO 09-18 07:18:07 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.967 GB, free space: 1.189GB, frag space: 0.469GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:07 llm_engine.py:773] Finished liquid for 31 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.35s, move and shrink latency: 0.12s, update worker latency: -0.12s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.967 GB, free space: 1.189GB, frag space: 0.469GB, current gpu block: #964
INFO 09-18 07:18:07 llm_engine.py:759] ---------Start 32'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:07 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:07 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.969 GB, free space: 1.187GB, frag space: 0.471GB, [(898899, 22.470703125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.22s to send model shards
INFO 09-18 07:18:07 worker.py:152] send weights shards takes: 0.26s, sent out: 6.19GB, sent bw: 23.42GB/s
INFO 09-18 07:18:07 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.922 GB, free space: 7.234GB, frag space: 0.618GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:07 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.69GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:07 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:07 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:07 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.053 GB, free space: 11.103GB, frag space: 0.546GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2236
INFO 09-18 07:18:07 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3200
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:08 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:18:08 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:18:08 llm_engine.py:773] Finished liquid for 32 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.82s, update worker latency: 0.00s, liquid model weights latency: 0.30s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.35s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.859 GB, free space: 2.297GB, frag space: 0.618GB, current gpu block: #3200
INFO 09-18 07:18:08 llm_engine.py:759] ---------Start 33'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:08 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:08 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.861 GB, free space: 2.295GB, frag space: 0.620GB, [(898899, 21.36328125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:08 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:08 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:08 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.26s to send model shards
INFO 09-18 07:18:08 worker.py:152] send weights shards takes: 0.29s, sent out: 3.10GB, sent bw: 10.74GB/s
INFO 09-18 07:18:08 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.145 GB, reserved space on GPU 0: 16.473 GB, free space: 5.683GB, frag space: 0.328GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:08 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:09 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.25GB, sent bw: 14.83GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:09 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:09 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:09 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
INFO 09-18 07:18:09 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:09 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.328GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
INFO 09-18 07:18:09 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:09 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.328GB, [(898899, 11.724609375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:09 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:09 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:09 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.56s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:09 worker.py:152] send weights shards takes: 0.59s, sent out: 3.10GB, sent bw: 5.25GB/s
INFO 09-18 07:18:09 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.328GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.721GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:09 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:10 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.25GB, sent bw: 15.18GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:10 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:10 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:10 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:10 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:10 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.328GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:10 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8097
INFO 09-18 07:18:10 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:10 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:10 worker.py:202] extend gpu in worker takes: 0.41s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:10 worker.py:202] extend gpu in worker takes: 0.42s
INFO 09-18 07:18:10 llm_engine.py:773] Finished liquid for 33 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.46s, update worker latency: 0.01s, liquid model weights latency: 1.52s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.42s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.459 GB, reserved space on GPU 0: 19.848 GB, free space: 2.308GB, frag space: 0.388GB, current gpu block: #8097
INFO 09-18 07:18:10 llm_engine.py:759] ---------Start 34'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:10 multiproc_gpu_executor.py:242] Shrink to: #3200, currently using blocks: #3
INFO 09-18 07:18:10 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.459 GB, reserved space on GPU 0: 19.850 GB, free space: 2.306GB, frag space: 0.390GB
INFO 09-18 07:18:11 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.328GB
INFO 09-18 07:18:11 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:11 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.328GB, [(898899, 11.724609375)]
INFO 09-18 07:18:11 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.223 GB, free space: 11.933GB, frag space: 0.328GB
INFO 09-18 07:18:11 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 13.230 GB, free space: 8.925GB, frag space: 0.239GB
INFO 09-18 07:18:11 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.471 GB, free space: 5.685GB, frag space: 3.479GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:11 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.33GB/s
INFO 09-18 07:18:11 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.471 GB, free space: 5.685GB, frag space: 3.479GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:11 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.471 GB, free space: 5.685GB, frag space: 3.479GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:11 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.25GB, sent bw: 13.83GB/s
INFO 09-18 07:18:11 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:12 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:12 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 20.424 GB, free space: 1.732GB, frag space: 1.183GB
INFO 09-18 07:18:12 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB
INFO 09-18 07:18:12 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:12 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:12 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, [(898899, 21.14453125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:12 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.895 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:12 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:12 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:12 worker.py:152] send weights shards takes: 0.26s, sent out: 3.10GB, sent bw: 11.73GB/s
INFO 09-18 07:18:12 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:12 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:13 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.25GB, sent bw: 14.82GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:13 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:13 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:13 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 20.170 GB, free space: 1.872GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:13 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
INFO 09-18 07:18:13 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.653GB, frag space: 0.000GB
INFO 09-18 07:18:13 llm_engine.py:773] Finished liquid for 34 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.64s, move and shrink latency: -1726640290.87s, update worker latency: 1726640290.87s, liquid model weights latency: 1.91s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, current gpu block: #3200
INFO 09-18 07:18:13 llm_engine.py:759] ---------Start 35'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:13 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #3
INFO 09-18 07:18:13 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.645 GB, free space: 2.511GB, frag space: 0.403GB
INFO 09-18 07:18:13 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.955 GB, free space: 11.201GB, frag space: 0.448GB
INFO 09-18 07:18:13 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:13 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.955 GB, free space: 11.201GB, frag space: 0.448GB, [(898899, 12.45703125)]
INFO 09-18 07:18:13 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.955 GB, free space: 11.201GB, frag space: 0.448GB
INFO 09-18 07:18:14 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.930 GB, free space: 5.226GB, frag space: 0.230GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:14 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 17.38GB/s
INFO 09-18 07:18:14 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.814 GB, free space: 1.341GB, frag space: 4.114GB
INFO 09-18 07:18:14 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.814 GB, free space: 1.341GB, frag space: 4.114GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:14 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.814 GB, free space: 1.341GB, frag space: 4.114GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:14 cache_engine.py:159] send kvc shards takes: 0.53s, sent out: 3.77GB, sent bw: 7.12GB/s
INFO 09-18 07:18:14 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.135 GB, free space: 1.021GB, frag space: 0.669GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:14 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:14 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 22.025 GB, free space: 0.130GB, frag space: 1.528GB
INFO 09-18 07:18:14 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.072 GB, free space: 1.084GB, frag space: 0.575GB
INFO 09-18 07:18:14 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.072 GB, free space: 1.084GB, frag space: 0.575GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:14 llm_engine.py:773] Finished liquid for 35 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.37s, move and shrink latency: 0.10s, update worker latency: -0.10s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.74s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.072 GB, free space: 1.084GB, frag space: 0.575GB, current gpu block: #964
INFO 09-18 07:18:14 llm_engine.py:759] ---------Start 36'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:14 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:14 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.074 GB, free space: 1.082GB, frag space: 0.577GB, [(898899, 22.576171875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:14 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:15 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:15 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.23s to send model shards
INFO 09-18 07:18:15 worker.py:152] send weights shards takes: 0.28s, sent out: 6.19GB, sent bw: 22.01GB/s
INFO 09-18 07:18:15 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 15.000 GB, free space: 7.156GB, frag space: 0.696GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:15 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:15 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.67GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:15 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:15 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:15 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:15 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:15 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.131 GB, free space: 11.025GB, frag space: 0.624GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2216
INFO 09-18 07:18:15 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3180
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:15 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:18:15 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:18:15 llm_engine.py:773] Finished liquid for 36 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.83s, update worker latency: 0.00s, liquid model weights latency: 0.32s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.36s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.696GB, current gpu block: #3180
INFO 09-18 07:18:15 llm_engine.py:759] ---------Start 37'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:15 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:15 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.698GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:15 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:16 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:16 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.25s to send model shards
INFO 09-18 07:18:16 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.34GB/s
INFO 09-18 07:18:16 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.082 GB, reserved space on GPU 0: 16.535 GB, free space: 5.621GB, frag space: 0.453GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:16 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:16 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.21GB, sent bw: 14.76GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:16 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:16 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.277GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:16 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.125GB
INFO 09-18 07:18:17 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:17 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.492GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
INFO 09-18 07:18:17 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:17 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.492GB, [(898899, 11.849609375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:17 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:17 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:17 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:17 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.64GB/s
INFO 09-18 07:18:17 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.492GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.784GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:17 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:17 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.21GB, sent bw: 15.18GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:17 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:17 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.277GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:17 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.125GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:17 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:17 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.492GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:17 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8013
INFO 09-18 07:18:18 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:18 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:18 worker.py:202] extend gpu in worker takes: 0.41s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:18 worker.py:202] extend gpu in worker takes: 0.42s
INFO 09-18 07:18:18 llm_engine.py:773] Finished liquid for 37 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.55s, update worker latency: 0.01s, liquid model weights latency: 1.56s, init mem latency: 0.00s, liquid kvc latency: 0.49s, extending gpu blocks latency: 0.42s, update blocks latency: 0.07s;, current mem info on GPU0: allocated space on GPU 0: 19.295 GB, reserved space on GPU 0: 19.785 GB, free space: 2.371GB, frag space: 0.490GB, current gpu block: #8013
INFO 09-18 07:18:18 llm_engine.py:759] ---------Start 38'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:18 multiproc_gpu_executor.py:242] Shrink to: #3180, currently using blocks: #3
INFO 09-18 07:18:18 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.295 GB, reserved space on GPU 0: 19.787 GB, free space: 2.369GB, frag space: 0.492GB
INFO 09-18 07:18:18 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.492GB
INFO 09-18 07:18:18 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:18 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.492GB, [(898899, 11.849609375)]
INFO 09-18 07:18:18 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.492GB
INFO 09-18 07:18:18 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 13.223 GB, free space: 8.933GB, frag space: 0.270GB
INFO 09-18 07:18:19 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.447 GB, free space: 5.709GB, frag space: 3.495GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.34s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:19 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.41GB/s
INFO 09-18 07:18:19 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.447 GB, free space: 5.709GB, frag space: 3.495GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:19 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.447 GB, free space: 5.709GB, frag space: 3.495GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:19 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.21GB, sent bw: 13.98GB/s
INFO 09-18 07:18:19 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.163 GB, reserved space on GPU 0: 19.658 GB, free space: 2.498GB, frag space: 0.495GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:19 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:19 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 20.377 GB, free space: 1.779GB, frag space: 1.198GB
INFO 09-18 07:18:19 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.596 GB, free space: 2.560GB, frag space: 0.417GB
INFO 09-18 07:18:19 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.596 GB, free space: 2.560GB, frag space: 0.417GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:19 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:19 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.596 GB, free space: 2.560GB, frag space: 0.417GB, [(898899, 21.09765625)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:19 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.856 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.215GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:20 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.294GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:20 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:20 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.59GB/s
INFO 09-18 07:18:20 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.596 GB, free space: 2.560GB, frag space: 0.417GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:20 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:20 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.21GB, sent bw: 14.87GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:20 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.163 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.226GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:20 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:20 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 20.107 GB, free space: 1.934GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:20 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 19.326 GB, free space: 2.716GB, frag space: 0.147GB
INFO 09-18 07:18:20 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.596 GB, free space: 2.560GB, frag space: 0.417GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.716GB, frag space: 0.000GB
INFO 09-18 07:18:20 llm_engine.py:773] Finished liquid for 38 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.49s, move and shrink latency: -1726640298.42s, update worker latency: 1726640298.42s, liquid model weights latency: 1.78s, init mem latency: 0.00s, liquid kvc latency: 0.71s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.596 GB, free space: 2.560GB, frag space: 0.417GB, current gpu block: #3180
INFO 09-18 07:18:20 llm_engine.py:759] ---------Start 39'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:20 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #3
INFO 09-18 07:18:20 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.598 GB, free space: 2.558GB, frag space: 0.419GB
INFO 09-18 07:18:21 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.971 GB, free space: 11.185GB, frag space: 0.464GB
INFO 09-18 07:18:21 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:21 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.971 GB, free space: 11.185GB, frag space: 0.464GB, [(898899, 12.47265625)]
INFO 09-18 07:18:21 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.971 GB, free space: 11.185GB, frag space: 0.464GB
INFO 09-18 07:18:21 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.914 GB, free space: 5.242GB, frag space: 0.214GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.31s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:21 worker.py:152] send weights shards takes: 0.34s, sent out: 6.19GB, sent bw: 18.34GB/s
INFO 09-18 07:18:21 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.924 GB, free space: 1.232GB, frag space: 4.223GB
INFO 09-18 07:18:21 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.924 GB, free space: 1.232GB, frag space: 4.223GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:21 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.924 GB, free space: 1.232GB, frag space: 4.223GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:21 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.52GB/s
INFO 09-18 07:18:21 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.025 GB, free space: 1.130GB, frag space: 0.559GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:22 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.916 GB, free space: 0.240GB, frag space: 1.419GB
INFO 09-18 07:18:22 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB
INFO 09-18 07:18:22 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:22 llm_engine.py:773] Finished liquid for 39 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.31s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.68s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB, current gpu block: #964
INFO 09-18 07:18:22 llm_engine.py:759] ---------Start 40'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:22 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:22 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.965 GB, free space: 1.191GB, frag space: 0.467GB, [(898899, 22.466796875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.23s to send model shards
INFO 09-18 07:18:22 worker.py:152] send weights shards takes: 0.27s, sent out: 6.19GB, sent bw: 22.56GB/s
INFO 09-18 07:18:22 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.922 GB, free space: 7.234GB, frag space: 0.618GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:22 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.67GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:22 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:22 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:22 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.053 GB, free space: 11.103GB, frag space: 0.546GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2236
INFO 09-18 07:18:22 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3200
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:23 worker.py:202] extend gpu in worker takes: 0.34s
INFO 09-18 07:18:23 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:18:23 llm_engine.py:773] Finished liquid for 40 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.83s, update worker latency: 0.00s, liquid model weights latency: 0.31s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.35s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.859 GB, free space: 2.297GB, frag space: 0.618GB, current gpu block: #3200
INFO 09-18 07:18:23 llm_engine.py:759] ---------Start 41'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:23 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:23 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.861 GB, free space: 2.295GB, frag space: 0.620GB, [(898899, 21.36328125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:23 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:23 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:23 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.24s to send model shards
INFO 09-18 07:18:23 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.44GB/s
INFO 09-18 07:18:23 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.145 GB, reserved space on GPU 0: 16.441 GB, free space: 5.714GB, frag space: 0.297GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:23 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:23 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.25GB, sent bw: 14.83GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:23 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:23 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:23 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
INFO 09-18 07:18:24 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:24 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.297GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
INFO 09-18 07:18:24 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:24 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.297GB, [(898899, 11.693359375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:24 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:24 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:24 worker.py:152] send weights shards takes: 0.45s, sent out: 3.10GB, sent bw: 6.84GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:24 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:24 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.297GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.721GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:24 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:24 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.25GB, sent bw: 15.14GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:24 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:24 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:24 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:25 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:25 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.297GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:25 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8113
INFO 09-18 07:18:25 worker.py:202] extend gpu in worker takes: 0.36s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:25 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:25 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:25 worker.py:202] extend gpu in worker takes: 0.39s
INFO 09-18 07:18:25 llm_engine.py:773] Finished liquid for 41 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.29s, update worker latency: 0.00s, liquid model weights latency: 1.38s, init mem latency: 0.00s, liquid kvc latency: 0.49s, extending gpu blocks latency: 0.40s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.520 GB, reserved space on GPU 0: 19.816 GB, free space: 2.339GB, frag space: 0.297GB, current gpu block: #8113
INFO 09-18 07:18:25 llm_engine.py:759] ---------Start 42'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:25 multiproc_gpu_executor.py:242] Shrink to: #3200, currently using blocks: #3
INFO 09-18 07:18:25 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.520 GB, reserved space on GPU 0: 19.818 GB, free space: 2.338GB, frag space: 0.298GB
INFO 09-18 07:18:25 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.297GB
INFO 09-18 07:18:25 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:25 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.297GB, [(898899, 11.693359375)]
INFO 09-18 07:18:25 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.191 GB, free space: 11.964GB, frag space: 0.297GB
INFO 09-18 07:18:26 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 13.238 GB, free space: 8.918GB, frag space: 0.247GB
INFO 09-18 07:18:26 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.494 GB, free space: 5.662GB, frag space: 3.503GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.36s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:26 worker.py:152] send weights shards takes: 0.39s, sent out: 3.10GB, sent bw: 7.96GB/s
INFO 09-18 07:18:26 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.494 GB, free space: 5.662GB, frag space: 3.503GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:26 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.494 GB, free space: 5.662GB, frag space: 3.503GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:26 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.25GB, sent bw: 13.58GB/s
INFO 09-18 07:18:26 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.358GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:26 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:27 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 20.381 GB, free space: 1.775GB, frag space: 1.140GB
INFO 09-18 07:18:27 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.358GB
INFO 09-18 07:18:27 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.358GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:18:27 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:27 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.358GB, [(898899, 21.1015625)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:27 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.895 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:27 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:27 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.25s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:27 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.45GB/s
INFO 09-18 07:18:27 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.358GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:27 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:27 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.25GB, sent bw: 14.79GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:27 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:27 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:28 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 20.170 GB, free space: 1.872GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:28 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
INFO 09-18 07:18:28 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.358GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.653GB, frag space: 0.000GB
INFO 09-18 07:18:28 llm_engine.py:773] Finished liquid for 42 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.73s, move and shrink latency: -1726640305.49s, update worker latency: 1726640305.50s, liquid model weights latency: 2.00s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.358GB, current gpu block: #3200
INFO 09-18 07:18:28 llm_engine.py:759] ---------Start 43'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:28 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #3
INFO 09-18 07:18:28 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.602 GB, free space: 2.554GB, frag space: 0.360GB
INFO 09-18 07:18:28 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.912 GB, free space: 11.244GB, frag space: 0.405GB
INFO 09-18 07:18:28 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:28 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.912 GB, free space: 11.244GB, frag space: 0.405GB, [(898899, 12.4140625)]
INFO 09-18 07:18:28 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.912 GB, free space: 11.244GB, frag space: 0.405GB
INFO 09-18 07:18:28 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.902 GB, free space: 5.254GB, frag space: 0.203GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:28 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 17.40GB/s
INFO 09-18 07:18:28 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.037 GB, free space: 1.119GB, frag space: 4.337GB
INFO 09-18 07:18:28 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.037 GB, free space: 1.119GB, frag space: 4.337GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:28 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.037 GB, free space: 1.119GB, frag space: 4.337GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:29 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.44GB/s
INFO 09-18 07:18:29 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.072 GB, free space: 1.084GB, frag space: 0.606GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:29 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:29 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.963 GB, free space: 0.193GB, frag space: 1.465GB
INFO 09-18 07:18:29 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.512GB
INFO 09-18 07:18:29 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.512GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:29 llm_engine.py:773] Finished liquid for 43 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.04s, move and shrink latency: 0.11s, update worker latency: -0.10s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.42s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.512GB, current gpu block: #964
INFO 09-18 07:18:29 llm_engine.py:759] ---------Start 44'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:29 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:29 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.012 GB, free space: 1.144GB, frag space: 0.514GB, [(898899, 22.513671875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:29 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:29 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:29 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.23s to send model shards
INFO 09-18 07:18:29 worker.py:152] send weights shards takes: 0.28s, sent out: 6.19GB, sent bw: 22.39GB/s
INFO 09-18 07:18:29 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.906 GB, free space: 7.250GB, frag space: 0.603GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:29 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:30 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.62GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:30 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:30 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:30 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:30 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:30 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.037 GB, free space: 11.119GB, frag space: 0.530GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2240
INFO 09-18 07:18:30 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3204
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:30 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:18:30 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:18:30 llm_engine.py:773] Finished liquid for 44 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.13s, update worker latency: 0.00s, liquid model weights latency: 0.60s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.37s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.906 GB, free space: 2.250GB, frag space: 0.649GB, current gpu block: #3204
INFO 09-18 07:18:30 llm_engine.py:759] ---------Start 45'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:30 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:30 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.908 GB, free space: 2.248GB, frag space: 0.651GB, [(898899, 21.41015625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:30 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:30 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:30 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.25s to send model shards
INFO 09-18 07:18:30 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 11.16GB/s
INFO 09-18 07:18:30 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.160 GB, reserved space on GPU 0: 16.504 GB, free space: 5.652GB, frag space: 0.343GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:30 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:31 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.26GB, sent bw: 14.79GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:31 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.097GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:31 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.295GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:31 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.140GB
INFO 09-18 07:18:31 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:31 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.351GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:18:31 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:31 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.351GB, [(898899, 11.755859375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:31 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:31 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:31 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:31 worker.py:152] send weights shards takes: 0.29s, sent out: 3.10GB, sent bw: 10.85GB/s
INFO 09-18 07:18:31 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.351GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:31 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:32 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.26GB, sent bw: 15.22GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:32 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:32 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.295GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:32 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.140GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:32 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:32 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.351GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:32 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8085
INFO 09-18 07:18:32 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:32 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:32 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:32 worker.py:202] extend gpu in worker takes: 0.42s
INFO 09-18 07:18:32 llm_engine.py:773] Finished liquid for 45 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.14s, update worker latency: 0.01s, liquid model weights latency: 1.21s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.42s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.457 GB, reserved space on GPU 0: 19.754 GB, free space: 2.402GB, frag space: 0.297GB, current gpu block: #8085
INFO 09-18 07:18:32 llm_engine.py:759] ---------Start 46'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:32 multiproc_gpu_executor.py:242] Shrink to: #3204, currently using blocks: #4
INFO 09-18 07:18:32 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.457 GB, reserved space on GPU 0: 19.756 GB, free space: 2.400GB, frag space: 0.298GB
INFO 09-18 07:18:32 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.351GB
INFO 09-18 07:18:32 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:32 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.351GB, [(898899, 11.755859375)]
INFO 09-18 07:18:32 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.351GB
INFO 09-18 07:18:33 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 13.297 GB, free space: 8.859GB, frag space: 0.298GB
INFO 09-18 07:18:33 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.475 GB, free space: 5.681GB, frag space: 3.476GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:33 worker.py:152] send weights shards takes: 0.38s, sent out: 3.10GB, sent bw: 8.21GB/s
INFO 09-18 07:18:33 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.475 GB, free space: 5.681GB, frag space: 3.476GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:33 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.475 GB, free space: 5.681GB, frag space: 3.476GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:33 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.26GB, sent bw: 13.82GB/s
INFO 09-18 07:18:33 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.713 GB, free space: 2.443GB, frag space: 0.456GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:33 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:34 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 20.439 GB, free space: 1.716GB, frag space: 1.183GB
INFO 09-18 07:18:34 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.650 GB, free space: 2.505GB, frag space: 0.394GB
INFO 09-18 07:18:34 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.650 GB, free space: 2.505GB, frag space: 0.394GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:34 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:34 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.650 GB, free space: 2.505GB, frag space: 0.394GB, [(898899, 21.15234375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:34 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.903 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.230GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:34 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.310GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:34 worker.py:152] send weights shards takes: 0.51s, sent out: 3.10GB, sent bw: 6.05GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:34 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.112GB
INFO 09-18 07:18:34 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.650 GB, free space: 2.505GB, frag space: 0.394GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:34 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.112GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:35 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.26GB, sent bw: 14.87GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:35 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.257GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:35 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:35 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.983GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:35 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.194GB
INFO 09-18 07:18:35 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.650 GB, free space: 2.505GB, frag space: 0.394GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:18:35 llm_engine.py:773] Finished liquid for 46 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.64s, move and shrink latency: -1726640312.70s, update worker latency: 1726640312.71s, liquid model weights latency: 1.91s, init mem latency: 0.00s, liquid kvc latency: 0.71s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.650 GB, free space: 2.505GB, frag space: 0.394GB, current gpu block: #3204
INFO 09-18 07:18:35 llm_engine.py:759] ---------Start 47'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:35 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #4
INFO 09-18 07:18:35 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.652 GB, free space: 2.504GB, frag space: 0.395GB
INFO 09-18 07:18:35 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.900 GB, free space: 11.255GB, frag space: 0.394GB
INFO 09-18 07:18:35 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:35 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.900 GB, free space: 11.255GB, frag space: 0.394GB, [(898899, 12.40234375)]
INFO 09-18 07:18:35 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.900 GB, free space: 11.255GB, frag space: 0.394GB
INFO 09-18 07:18:35 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.906 GB, free space: 5.250GB, frag space: 0.207GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:35 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.46GB/s
INFO 09-18 07:18:35 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 4.309GB
INFO 09-18 07:18:35 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 4.309GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:35 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 4.309GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:36 cache_engine.py:159] send kvc shards takes: 0.20s, sent out: 3.77GB, sent bw: 19.19GB/s
INFO 09-18 07:18:36 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.104 GB, free space: 1.052GB, frag space: 0.637GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:36 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:36 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.994 GB, free space: 0.162GB, frag space: 1.497GB
INFO 09-18 07:18:36 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.544GB
INFO 09-18 07:18:36 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.544GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:36 llm_engine.py:773] Finished liquid for 47 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.03s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.41s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.544GB, current gpu block: #964
INFO 09-18 07:18:36 llm_engine.py:759] ---------Start 48'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:36 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:36 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.043 GB, free space: 1.113GB, frag space: 0.545GB, [(898899, 22.544921875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:36 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:36 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.26s to send model shards
INFO 09-18 07:18:37 worker.py:152] send weights shards takes: 0.58s, sent out: 6.19GB, sent bw: 10.72GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:37 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:37 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 15.062 GB, free space: 7.093GB, frag space: 0.759GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:37 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:37 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.76GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:37 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:37 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:37 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:37 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:37 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.193 GB, free space: 10.963GB, frag space: 0.686GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2200
INFO 09-18 07:18:37 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3164
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:37 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:18:37 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:18:37 llm_engine.py:773] Finished liquid for 48 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.16s, update worker latency: 0.00s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.759GB, current gpu block: #3164
INFO 09-18 07:18:37 llm_engine.py:759] ---------Start 49'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:37 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:37 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.761GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:37 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:37 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:37 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.25s to send model shards
INFO 09-18 07:18:37 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 11.19GB/s
INFO 09-18 07:18:37 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.020 GB, reserved space on GPU 0: 16.457 GB, free space: 5.699GB, frag space: 0.437GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.860GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:37 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:38 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.18GB, sent bw: 14.76GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:38 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.809 GB, reserved space on GPU 2: 10.852 GB, free space: 11.687GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:38 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.809 GB, reserved space on GPU 2: 11.045 GB, free space: 11.494GB, frag space: 1.236GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:38 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.809 GB, reserved space on GPU 2: 9.895 GB, free space: 12.644GB, frag space: 0.086GB
INFO 09-18 07:18:38 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:38 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.270 GB, free space: 11.886GB, frag space: 0.437GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.860GB, frag space: 0.000GB
INFO 09-18 07:18:38 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:38 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.270 GB, free space: 11.886GB, frag space: 0.437GB, [(898899, 11.771484375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:38 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:38 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:38 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:38 worker.py:152] send weights shards takes: 0.29s, sent out: 3.10GB, sent bw: 10.50GB/s
INFO 09-18 07:18:38 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.270 GB, free space: 11.886GB, frag space: 0.437GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.846GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:38 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:39 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.18GB, sent bw: 15.16GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:39 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.809 GB, reserved space on GPU 3: 10.852 GB, free space: 11.687GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:39 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.809 GB, reserved space on GPU 3: 11.045 GB, free space: 11.494GB, frag space: 1.236GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:39 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.809 GB, reserved space on GPU 3: 9.895 GB, free space: 12.644GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:39 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:39 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.270 GB, free space: 11.886GB, frag space: 0.437GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 12.034GB, frag space: 0.000GB
INFO 09-18 07:18:39 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8037
INFO 09-18 07:18:39 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:39 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:39 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:39 worker.py:202] extend gpu in worker takes: 0.43s
INFO 09-18 07:18:40 llm_engine.py:773] Finished liquid for 49 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.38s, update worker latency: 0.01s, liquid model weights latency: 1.21s, init mem latency: 0.00s, liquid kvc latency: 0.71s, extending gpu blocks latency: 0.43s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.342 GB, reserved space on GPU 0: 19.832 GB, free space: 2.324GB, frag space: 0.490GB, current gpu block: #8037
INFO 09-18 07:18:40 llm_engine.py:759] ---------Start 50'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:40 multiproc_gpu_executor.py:242] Shrink to: #3164, currently using blocks: #4
INFO 09-18 07:18:40 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.342 GB, reserved space on GPU 0: 19.834 GB, free space: 2.322GB, frag space: 0.492GB
INFO 09-18 07:18:40 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.270 GB, free space: 11.886GB, frag space: 0.437GB
INFO 09-18 07:18:40 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:40 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.270 GB, free space: 11.886GB, frag space: 0.437GB, [(898899, 11.771484375)]
INFO 09-18 07:18:40 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.832 GB, reserved space on GPU 0: 10.270 GB, free space: 11.886GB, frag space: 0.437GB
INFO 09-18 07:18:40 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 13.156 GB, free space: 9.000GB, frag space: 0.228GB
INFO 09-18 07:18:40 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 16.459 GB, free space: 5.697GB, frag space: 3.530GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.34s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:40 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.48GB/s
INFO 09-18 07:18:40 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 16.459 GB, free space: 5.697GB, frag space: 3.530GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 12.034GB, frag space: 0.000GB
INFO 09-18 07:18:40 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.929 GB, reserved space on GPU 0: 16.459 GB, free space: 5.697GB, frag space: 3.530GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:41 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.18GB, sent bw: 13.96GB/s
INFO 09-18 07:18:41 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.529 GB, free space: 2.627GB, frag space: 0.413GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:41 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:41 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 20.303 GB, free space: 1.853GB, frag space: 1.186GB
INFO 09-18 07:18:41 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.529 GB, free space: 2.627GB, frag space: 0.413GB
INFO 09-18 07:18:41 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.529 GB, free space: 2.627GB, frag space: 0.413GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 12.034GB, frag space: 0.000GB
INFO 09-18 07:18:41 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:41 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.529 GB, free space: 2.627GB, frag space: 0.413GB, [(898899, 21.03125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:41 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.832 GB, reserved space on GPU 1: 10.008 GB, free space: 12.034GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:41 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.929 GB, reserved space on GPU 1: 13.184 GB, free space: 8.858GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:41 worker.py:152] send weights shards takes: 0.51s, sent out: 3.10GB, sent bw: 6.06GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:41 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.929 GB, reserved space on GPU 1: 15.986 GB, free space: 6.055GB, frag space: 3.058GB
INFO 09-18 07:18:41 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.529 GB, free space: 2.627GB, frag space: 0.413GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 6.055GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:41 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.929 GB, reserved space on GPU 1: 15.986 GB, free space: 6.055GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:42 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.18GB, sent bw: 14.79GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:42 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.116 GB, reserved space on GPU 1: 19.264 GB, free space: 2.778GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:42 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:42 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.116 GB, reserved space on GPU 1: 20.811 GB, free space: 1.231GB, frag space: 1.694GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:42 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.116 GB, reserved space on GPU 1: 19.264 GB, free space: 2.778GB, frag space: 0.147GB
INFO 09-18 07:18:42 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.529 GB, free space: 2.627GB, frag space: 0.413GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.778GB, frag space: 0.000GB
INFO 09-18 07:18:42 llm_engine.py:773] Finished liquid for 50 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.61s, move and shrink latency: -1726640320.05s, update worker latency: 1726640320.06s, liquid model weights latency: 1.90s, init mem latency: 0.00s, liquid kvc latency: 0.70s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.529 GB, free space: 2.627GB, frag space: 0.413GB, current gpu block: #3164
INFO 09-18 07:18:42 llm_engine.py:759] ---------Start 51'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:42 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #4
INFO 09-18 07:18:42 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.116 GB, reserved space on GPU 0: 19.531 GB, free space: 2.625GB, frag space: 0.415GB
INFO 09-18 07:18:42 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.967 GB, free space: 11.189GB, frag space: 0.460GB
INFO 09-18 07:18:42 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:42 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.967 GB, free space: 11.189GB, frag space: 0.460GB, [(898899, 12.46875)]
INFO 09-18 07:18:42 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.967 GB, free space: 11.189GB, frag space: 0.460GB
INFO 09-18 07:18:43 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.910 GB, free space: 5.246GB, frag space: 0.211GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.31s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:43 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.92GB/s
INFO 09-18 07:18:43 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.139 GB, free space: 1.017GB, frag space: 4.438GB
INFO 09-18 07:18:43 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.139 GB, free space: 1.017GB, frag space: 4.438GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:43 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.139 GB, free space: 1.017GB, frag space: 4.438GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:43 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.38GB/s
INFO 09-18 07:18:43 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.016 GB, free space: 1.140GB, frag space: 0.549GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:43 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:43 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.424 GB, free space: 0.732GB, frag space: 0.926GB
INFO 09-18 07:18:43 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB
INFO 09-18 07:18:43 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:43 llm_engine.py:773] Finished liquid for 51 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.04s, move and shrink latency: 0.12s, update worker latency: -0.11s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.41s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.947 GB, free space: 1.209GB, frag space: 0.450GB, current gpu block: #964
INFO 09-18 07:18:43 llm_engine.py:759] ---------Start 52'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:43 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:43 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.949 GB, free space: 1.207GB, frag space: 0.452GB, [(898899, 22.451171875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:43 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:44 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.26s to send model shards
INFO 09-18 07:18:44 worker.py:152] send weights shards takes: 0.59s, sent out: 6.19GB, sent bw: 10.57GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:44 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:44 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.844 GB, free space: 7.312GB, frag space: 0.540GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:44 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:44 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.18GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:44 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:44 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:44 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:44 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:44 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.975 GB, free space: 11.181GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2256
INFO 09-18 07:18:44 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3220
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:44 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:18:44 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:18:44 llm_engine.py:773] Finished liquid for 52 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.17s, update worker latency: 0.00s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.39s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.906 GB, free space: 2.250GB, frag space: 0.587GB, current gpu block: #3220
INFO 09-18 07:18:44 llm_engine.py:759] ---------Start 53'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:44 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:45 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.908 GB, free space: 2.248GB, frag space: 0.589GB, [(898899, 21.41015625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:45 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:45 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:45 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.26s to send model shards
INFO 09-18 07:18:45 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 10.94GB/s
INFO 09-18 07:18:45 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.223 GB, reserved space on GPU 0: 16.441 GB, free space: 5.714GB, frag space: 0.218GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.610GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:45 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:45 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.29GB, sent bw: 14.79GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:45 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:45 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.240GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:45 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.086GB
INFO 09-18 07:18:45 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:45 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.129 GB, free space: 12.027GB, frag space: 0.172GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.610GB, frag space: 0.000GB
INFO 09-18 07:18:45 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:45 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.129 GB, free space: 12.027GB, frag space: 0.172GB, [(898899, 11.630859375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:45 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:46 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:46 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.27s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:46 worker.py:152] send weights shards takes: 0.29s, sent out: 3.10GB, sent bw: 10.51GB/s
INFO 09-18 07:18:46 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.129 GB, free space: 12.027GB, frag space: 0.172GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.596GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:46 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:46 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.29GB, sent bw: 15.20GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:46 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:46 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.240GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:46 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:46 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:46 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.129 GB, free space: 12.027GB, frag space: 0.172GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:46 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8105
INFO 09-18 07:18:47 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:47 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:47 worker.py:202] extend gpu in worker takes: 0.44s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:47 worker.py:202] extend gpu in worker takes: 0.44s
INFO 09-18 07:18:47 llm_engine.py:773] Finished liquid for 53 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.39s, update worker latency: 0.00s, liquid model weights latency: 1.25s, init mem latency: 0.00s, liquid kvc latency: 0.69s, extending gpu blocks latency: 0.44s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.475 GB, reserved space on GPU 0: 19.691 GB, free space: 2.464GB, frag space: 0.216GB, current gpu block: #8105
INFO 09-18 07:18:47 llm_engine.py:759] ---------Start 54'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:47 multiproc_gpu_executor.py:242] Shrink to: #3220, currently using blocks: #4
INFO 09-18 07:18:47 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.475 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.218GB
INFO 09-18 07:18:47 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.129 GB, free space: 12.027GB, frag space: 0.172GB
INFO 09-18 07:18:47 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:47 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.129 GB, free space: 12.027GB, frag space: 0.172GB, [(898899, 11.630859375)]
INFO 09-18 07:18:47 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.129 GB, free space: 12.027GB, frag space: 0.172GB
INFO 09-18 07:18:47 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 13.305 GB, free space: 8.851GB, frag space: 0.251GB
INFO 09-18 07:18:47 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.545 GB, free space: 5.611GB, frag space: 3.491GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:47 worker.py:152] send weights shards takes: 0.38s, sent out: 3.10GB, sent bw: 8.26GB/s
INFO 09-18 07:18:47 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.545 GB, free space: 5.611GB, frag space: 3.491GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:47 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.545 GB, free space: 5.611GB, frag space: 3.491GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:48 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.29GB, sent bw: 14.07GB/s
INFO 09-18 07:18:48 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.748 GB, free space: 2.408GB, frag space: 0.382GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:48 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:48 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 20.537 GB, free space: 1.619GB, frag space: 1.218GB
INFO 09-18 07:18:48 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.748 GB, free space: 2.408GB, frag space: 0.429GB
INFO 09-18 07:18:48 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.748 GB, free space: 2.408GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:48 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:48 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.748 GB, free space: 2.408GB, frag space: 0.429GB, [(898899, 21.25)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:48 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.957 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:49 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:49 worker.py:152] send weights shards takes: 0.51s, sent out: 3.10GB, sent bw: 6.05GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:49 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.058GB
INFO 09-18 07:18:49 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.748 GB, free space: 2.408GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:49 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:49 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.29GB, sent bw: 14.69GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:49 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.366 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:49 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:50 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.319 GB, reserved space on GPU 1: 20.303 GB, free space: 1.739GB, frag space: 0.983GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:50 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.319 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.194GB
INFO 09-18 07:18:50 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.748 GB, free space: 2.408GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.528GB, frag space: 0.000GB
INFO 09-18 07:18:50 llm_engine.py:773] Finished liquid for 54 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.64s, move and shrink latency: -1726640327.41s, update worker latency: 1726640327.41s, liquid model weights latency: 1.90s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.748 GB, free space: 2.408GB, frag space: 0.429GB, current gpu block: #3220
INFO 09-18 07:18:50 llm_engine.py:759] ---------Start 55'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:50 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #4
INFO 09-18 07:18:50 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.319 GB, reserved space on GPU 0: 19.750 GB, free space: 2.406GB, frag space: 0.431GB
INFO 09-18 07:18:50 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.936 GB, free space: 11.220GB, frag space: 0.429GB
INFO 09-18 07:18:50 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:50 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.936 GB, free space: 11.220GB, frag space: 0.429GB, [(898899, 12.4375)]
INFO 09-18 07:18:50 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.936 GB, free space: 11.220GB, frag space: 0.429GB
INFO 09-18 07:18:50 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.910 GB, free space: 5.246GB, frag space: 0.211GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.31s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:50 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.82GB/s
INFO 09-18 07:18:50 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.889 GB, free space: 1.267GB, frag space: 4.188GB
INFO 09-18 07:18:50 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.889 GB, free space: 1.267GB, frag space: 4.188GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:50 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.889 GB, free space: 1.267GB, frag space: 4.188GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:50 cache_engine.py:159] send kvc shards takes: 0.20s, sent out: 3.77GB, sent bw: 19.26GB/s
INFO 09-18 07:18:50 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.575GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:50 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:51 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.932 GB, free space: 0.224GB, frag space: 1.434GB
INFO 09-18 07:18:51 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB
INFO 09-18 07:18:51 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:51 llm_engine.py:773] Finished liquid for 55 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.03s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.40s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, current gpu block: #964
INFO 09-18 07:18:51 llm_engine.py:759] ---------Start 56'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:51 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:51 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.980 GB, free space: 1.175GB, frag space: 0.483GB, [(898899, 22.482421875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:51 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:51 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.22s to send model shards
INFO 09-18 07:18:51 worker.py:152] send weights shards takes: 0.54s, sent out: 6.19GB, sent bw: 11.46GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:51 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:51 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.875 GB, free space: 7.281GB, frag space: 0.571GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:51 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:51 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 32.92GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:51 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:51 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:51 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:51 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:51 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.006 GB, free space: 11.150GB, frag space: 0.499GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2248
INFO 09-18 07:18:51 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3212
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:52 worker.py:202] extend gpu in worker takes: 0.34s
INFO 09-18 07:18:52 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:18:52 llm_engine.py:773] Finished liquid for 56 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.17s, update worker latency: 0.00s, liquid model weights latency: 0.58s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.36s, update blocks latency: 0.06s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.571GB, current gpu block: #3212
INFO 09-18 07:18:52 llm_engine.py:759] ---------Start 57'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:52 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:52 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.573GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:52 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:52 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:52 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.25s to send model shards
INFO 09-18 07:18:52 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.42GB/s
INFO 09-18 07:18:52 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.207 GB, reserved space on GPU 0: 16.598 GB, free space: 5.558GB, frag space: 0.390GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:52 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:18:53 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.27GB, sent bw: 14.74GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:53 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:53 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.279GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:53 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.125GB
INFO 09-18 07:18:53 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:18:53 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:18:53 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:18:53 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.429GB, [(898899, 11.849609375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:53 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:53 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:53 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:53 worker.py:152] send weights shards takes: 0.29s, sent out: 3.10GB, sent bw: 10.80GB/s
INFO 09-18 07:18:53 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:53 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:54 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.27GB, sent bw: 15.25GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:54 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:54 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.279GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:54 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.125GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:54 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:18:54 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:54 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8045
INFO 09-18 07:18:54 worker.py:202] extend gpu in worker takes: 0.34s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:54 worker.py:202] extend gpu in worker takes: 0.34s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:54 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:54 worker.py:202] extend gpu in worker takes: 0.39s
INFO 09-18 07:18:54 llm_engine.py:773] Finished liquid for 57 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.33s, update worker latency: 0.01s, liquid model weights latency: 1.25s, init mem latency: 0.00s, liquid kvc latency: 0.67s, extending gpu blocks latency: 0.39s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.358 GB, reserved space on GPU 0: 19.785 GB, free space: 2.371GB, frag space: 0.427GB, current gpu block: #8045
INFO 09-18 07:18:54 llm_engine.py:759] ---------Start 58'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:18:54 multiproc_gpu_executor.py:242] Shrink to: #3212, currently using blocks: #4
INFO 09-18 07:18:54 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.358 GB, reserved space on GPU 0: 19.787 GB, free space: 2.369GB, frag space: 0.429GB
INFO 09-18 07:18:54 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.429GB
INFO 09-18 07:18:54 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:18:54 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.429GB, [(898899, 11.849609375)]
INFO 09-18 07:18:54 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.348 GB, free space: 11.808GB, frag space: 0.429GB
INFO 09-18 07:18:55 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 13.293 GB, free space: 8.863GB, frag space: 0.278GB
INFO 09-18 07:18:55 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.424 GB, free space: 5.732GB, frag space: 3.409GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:55 worker.py:152] send weights shards takes: 0.35s, sent out: 3.10GB, sent bw: 8.83GB/s
INFO 09-18 07:18:55 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.424 GB, free space: 5.732GB, frag space: 3.409GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:55 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.424 GB, free space: 5.732GB, frag space: 3.409GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:55 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.27GB, sent bw: 14.08GB/s
INFO 09-18 07:18:55 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.288 GB, reserved space on GPU 0: 19.627 GB, free space: 2.529GB, frag space: 0.339GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:55 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:18:56 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 20.354 GB, free space: 1.802GB, frag space: 1.050GB
INFO 09-18 07:18:56 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.564 GB, free space: 2.591GB, frag space: 0.261GB
INFO 09-18 07:18:56 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.564 GB, free space: 2.591GB, frag space: 0.261GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:18:56 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:18:56 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.564 GB, free space: 2.591GB, frag space: 0.261GB, [(898899, 21.06640625)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:56 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.918 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.215GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:56 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.294GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.23s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:56 worker.py:152] send weights shards takes: 0.50s, sent out: 3.10GB, sent bw: 6.23GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:56 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.097GB
INFO 09-18 07:18:56 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.564 GB, free space: 2.591GB, frag space: 0.261GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:56 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:57 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.27GB, sent bw: 14.73GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:57 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.288 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.226GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:18:57 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:57 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.936GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:57 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.147GB
INFO 09-18 07:18:57 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.564 GB, free space: 2.591GB, frag space: 0.261GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:18:57 llm_engine.py:773] Finished liquid for 58 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.67s, move and shrink latency: -1726640334.73s, update worker latency: 1726640334.73s, liquid model weights latency: 1.93s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.564 GB, free space: 2.591GB, frag space: 0.261GB, current gpu block: #3212
INFO 09-18 07:18:57 llm_engine.py:759] ---------Start 59'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:18:57 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #4
INFO 09-18 07:18:57 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.566 GB, free space: 2.589GB, frag space: 0.263GB
INFO 09-18 07:18:57 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.814 GB, free space: 11.341GB, frag space: 0.308GB
INFO 09-18 07:18:57 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:18:57 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.814 GB, free space: 11.341GB, frag space: 0.308GB, [(898899, 12.31640625)]
INFO 09-18 07:18:57 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.814 GB, free space: 11.341GB, frag space: 0.308GB
INFO 09-18 07:18:57 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.883 GB, free space: 5.273GB, frag space: 0.183GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:57 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 17.16GB/s
INFO 09-18 07:18:58 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.768 GB, free space: 1.388GB, frag space: 4.067GB
INFO 09-18 07:18:58 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.768 GB, free space: 1.388GB, frag space: 4.067GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:18:58 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.768 GB, free space: 1.388GB, frag space: 4.067GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:58 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.95GB/s
INFO 09-18 07:18:58 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.057 GB, free space: 1.099GB, frag space: 0.590GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:58 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:18:58 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.947 GB, free space: 0.209GB, frag space: 1.450GB
INFO 09-18 07:18:58 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB
INFO 09-18 07:18:58 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:18:58 llm_engine.py:773] Finished liquid for 59 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.04s, move and shrink latency: 0.11s, update worker latency: -0.10s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.40s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB, current gpu block: #964
INFO 09-18 07:18:58 llm_engine.py:759] ---------Start 60'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:18:58 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:18:58 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.996 GB, free space: 1.160GB, frag space: 0.499GB, [(898899, 22.498046875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:58 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:58 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.26s to send model shards
INFO 09-18 07:18:59 worker.py:152] send weights shards takes: 0.56s, sent out: 6.19GB, sent bw: 11.09GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:59 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:59 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.953 GB, free space: 7.203GB, frag space: 0.649GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:59 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:18:59 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.82GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:59 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:59 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:59 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:18:59 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:18:59 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.084 GB, free space: 11.072GB, frag space: 0.577GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2228
INFO 09-18 07:18:59 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3192
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:18:59 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:18:59 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:18:59 llm_engine.py:773] Finished liquid for 60 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.13s, update worker latency: 0.00s, liquid model weights latency: 0.60s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.37s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.891 GB, free space: 2.265GB, frag space: 0.649GB, current gpu block: #3192
INFO 09-18 07:18:59 llm_engine.py:759] ---------Start 61'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:18:59 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:18:59 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.893 GB, free space: 2.263GB, frag space: 0.651GB, [(898899, 21.39453125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:18:59 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:00 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:00 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.28s to send model shards
INFO 09-18 07:19:00 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 10.04GB/s
INFO 09-18 07:19:00 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.145 GB, reserved space on GPU 0: 16.613 GB, free space: 5.543GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:00 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:00 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.23GB, sent bw: 14.79GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:00 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:00 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:00 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
INFO 09-18 07:19:00 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:00 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
INFO 09-18 07:19:00 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:00 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.468GB, [(898899, 11.865234375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:00 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:00 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:00 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.28s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:00 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 10.00GB/s
INFO 09-18 07:19:00 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.721GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:00 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:01 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.23GB, sent bw: 15.21GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:01 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:01 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:01 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:01 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:01 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:01 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8017
INFO 09-18 07:19:02 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:02 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:02 worker.py:202] extend gpu in worker takes: 0.44s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:02 worker.py:202] extend gpu in worker takes: 0.44s
INFO 09-18 07:19:02 llm_engine.py:773] Finished liquid for 61 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.42s, update worker latency: 0.01s, liquid model weights latency: 1.27s, init mem latency: 0.00s, liquid kvc latency: 0.69s, extending gpu blocks latency: 0.44s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.332 GB, reserved space on GPU 0: 19.801 GB, free space: 2.355GB, frag space: 0.468GB, current gpu block: #8017
INFO 09-18 07:19:02 llm_engine.py:759] ---------Start 62'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:02 multiproc_gpu_executor.py:242] Shrink to: #3192, currently using blocks: #5
INFO 09-18 07:19:02 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.332 GB, reserved space on GPU 0: 19.803 GB, free space: 2.353GB, frag space: 0.470GB
INFO 09-18 07:19:02 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.468GB
INFO 09-18 07:19:02 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:02 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.468GB, [(898899, 11.865234375)]
INFO 09-18 07:19:02 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.468GB
INFO 09-18 07:19:02 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 13.219 GB, free space: 8.937GB, frag space: 0.228GB
INFO 09-18 07:19:02 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.381 GB, free space: 5.775GB, frag space: 3.390GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:02 worker.py:152] send weights shards takes: 0.38s, sent out: 3.10GB, sent bw: 8.25GB/s
INFO 09-18 07:19:02 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.381 GB, free space: 5.775GB, frag space: 3.390GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:02 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.381 GB, free space: 5.775GB, frag space: 3.390GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:03 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.23GB, sent bw: 13.72GB/s
INFO 09-18 07:19:03 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:03 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:03 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 20.424 GB, free space: 1.732GB, frag space: 1.183GB
INFO 09-18 07:19:03 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB
INFO 09-18 07:19:03 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:03 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:03 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, [(898899, 21.14453125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:03 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.895 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:03 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:04 worker.py:152] send weights shards takes: 0.51s, sent out: 3.10GB, sent bw: 6.02GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:04 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
INFO 09-18 07:19:04 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:04 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:04 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.23GB, sent bw: 14.74GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:04 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:04 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:04 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 20.170 GB, free space: 1.872GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:04 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
INFO 09-18 07:19:04 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.653GB, frag space: 0.000GB
INFO 09-18 07:19:04 llm_engine.py:773] Finished liquid for 62 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.64s, move and shrink latency: -1726640342.14s, update worker latency: 1726640342.15s, liquid model weights latency: 1.91s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.643 GB, free space: 2.513GB, frag space: 0.401GB, current gpu block: #3192
INFO 09-18 07:19:04 llm_engine.py:759] ---------Start 63'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:04 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #5
INFO 09-18 07:19:04 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.645 GB, free space: 2.511GB, frag space: 0.403GB
INFO 09-18 07:19:04 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.955 GB, free space: 11.201GB, frag space: 0.448GB
INFO 09-18 07:19:04 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:04 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.955 GB, free space: 11.201GB, frag space: 0.448GB, [(898899, 12.45703125)]
INFO 09-18 07:19:04 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.955 GB, free space: 11.201GB, frag space: 0.448GB
INFO 09-18 07:19:05 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.898 GB, free space: 5.257GB, frag space: 0.199GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:05 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 17.01GB/s
INFO 09-18 07:19:05 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.877 GB, free space: 1.279GB, frag space: 4.176GB
INFO 09-18 07:19:05 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.877 GB, free space: 1.279GB, frag space: 4.176GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:05 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.877 GB, free space: 1.279GB, frag space: 4.176GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:05 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.45GB/s
INFO 09-18 07:19:05 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.575GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:05 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:05 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.932 GB, free space: 0.224GB, frag space: 1.434GB
INFO 09-18 07:19:05 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB
INFO 09-18 07:19:05 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:05 llm_engine.py:773] Finished liquid for 63 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.02s, move and shrink latency: 0.10s, update worker latency: -0.10s, liquid model weights latency: 0.61s, init mem latency: 0.00s, liquid kvc latency: 0.40s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, current gpu block: #964
INFO 09-18 07:19:05 llm_engine.py:759] ---------Start 64'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:05 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:05 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.980 GB, free space: 1.175GB, frag space: 0.483GB, [(898899, 22.482421875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:05 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:06 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.26s to send model shards
INFO 09-18 07:19:06 worker.py:152] send weights shards takes: 0.59s, sent out: 6.19GB, sent bw: 10.50GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:06 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:06 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.812 GB, free space: 7.343GB, frag space: 0.509GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:06 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:06 cache_engine.py:159] send kvc shards takes: 0.12s, sent out: 3.77GB, sent bw: 31.93GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:06 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:06 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:06 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:06 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:06 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.943 GB, free space: 11.213GB, frag space: 0.436GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2264
INFO 09-18 07:19:06 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3228
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:07 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:19:07 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:19:07 llm_engine.py:773] Finished liquid for 64 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.17s, update worker latency: 0.00s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.37s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.509GB, current gpu block: #3228
INFO 09-18 07:19:07 llm_engine.py:759] ---------Start 65'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:07 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:07 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.511GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:07 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:07 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:07 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.25s to send model shards
INFO 09-18 07:19:07 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 11.24GB/s
INFO 09-18 07:19:07 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.270 GB, reserved space on GPU 0: 16.629 GB, free space: 5.527GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.610GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:07 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:07 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.30GB, sent bw: 14.83GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:07 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:07 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.240GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:07 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.934 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.086GB
INFO 09-18 07:19:07 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:07 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.316 GB, free space: 11.839GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.610GB, frag space: 0.000GB
INFO 09-18 07:19:07 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:08 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.316 GB, free space: 11.839GB, frag space: 0.359GB, [(898899, 11.818359375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:08 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:08 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:08 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.25s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:08 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.27GB/s
INFO 09-18 07:19:08 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.316 GB, free space: 11.839GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.596GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:08 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:08 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.30GB, sent bw: 15.20GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:08 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:08 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.240GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:08 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.934 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:08 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:09 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.316 GB, free space: 11.839GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:09 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8077
INFO 09-18 07:19:09 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:09 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:09 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:09 worker.py:202] extend gpu in worker takes: 0.41s
INFO 09-18 07:19:09 llm_engine.py:773] Finished liquid for 65 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.36s, update worker latency: 0.01s, liquid model weights latency: 1.24s, init mem latency: 0.00s, liquid kvc latency: 0.70s, extending gpu blocks latency: 0.41s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.420 GB, reserved space on GPU 0: 19.816 GB, free space: 2.339GB, frag space: 0.396GB, current gpu block: #8077
INFO 09-18 07:19:09 llm_engine.py:759] ---------Start 66'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:09 multiproc_gpu_executor.py:242] Shrink to: #3228, currently using blocks: #5
INFO 09-18 07:19:09 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.420 GB, reserved space on GPU 0: 19.818 GB, free space: 2.338GB, frag space: 0.398GB
INFO 09-18 07:19:09 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.316 GB, free space: 11.839GB, frag space: 0.359GB
INFO 09-18 07:19:09 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:09 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.316 GB, free space: 11.839GB, frag space: 0.359GB, [(898899, 11.818359375)]
INFO 09-18 07:19:09 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.957 GB, reserved space on GPU 0: 10.316 GB, free space: 11.839GB, frag space: 0.359GB
INFO 09-18 07:19:10 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 13.293 GB, free space: 8.863GB, frag space: 0.239GB
INFO 09-18 07:19:10 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.471 GB, free space: 5.685GB, frag space: 3.417GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:10 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.28GB/s
INFO 09-18 07:19:10 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.471 GB, free space: 5.685GB, frag space: 3.417GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:10 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.054 GB, reserved space on GPU 0: 16.471 GB, free space: 5.685GB, frag space: 3.417GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:10 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.30GB, sent bw: 13.90GB/s
INFO 09-18 07:19:10 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.775 GB, free space: 2.380GB, frag space: 0.409GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:10 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:10 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 20.564 GB, free space: 1.591GB, frag space: 1.198GB
INFO 09-18 07:19:10 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.775 GB, free space: 2.380GB, frag space: 0.409GB
INFO 09-18 07:19:10 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.775 GB, free space: 2.380GB, frag space: 0.409GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:10 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:10 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.775 GB, free space: 2.380GB, frag space: 0.409GB, [(898899, 21.27734375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:10 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.957 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:11 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:11 worker.py:152] send weights shards takes: 0.51s, sent out: 3.10GB, sent bw: 6.09GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:11 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.058GB
INFO 09-18 07:19:11 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.775 GB, free space: 2.380GB, frag space: 0.409GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:11 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.054 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:11 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.30GB, sent bw: 14.80GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:11 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.366 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:11 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:12 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.366 GB, reserved space on GPU 1: 20.303 GB, free space: 1.739GB, frag space: 0.936GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:12 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.366 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.147GB
INFO 09-18 07:19:12 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.775 GB, free space: 2.380GB, frag space: 0.409GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.528GB, frag space: 0.000GB
INFO 09-18 07:19:12 llm_engine.py:773] Finished liquid for 66 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.69s, move and shrink latency: -1726640349.46s, update worker latency: 1726640349.47s, liquid model weights latency: 1.96s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.775 GB, free space: 2.380GB, frag space: 0.409GB, current gpu block: #3228
INFO 09-18 07:19:12 llm_engine.py:759] ---------Start 67'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:12 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #5
INFO 09-18 07:19:12 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.366 GB, reserved space on GPU 0: 19.777 GB, free space: 2.379GB, frag space: 0.411GB
INFO 09-18 07:19:12 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.963 GB, free space: 11.193GB, frag space: 0.456GB
INFO 09-18 07:19:12 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:12 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.963 GB, free space: 11.193GB, frag space: 0.456GB, [(898899, 12.46484375)]
INFO 09-18 07:19:12 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.963 GB, free space: 11.193GB, frag space: 0.456GB
INFO 09-18 07:19:12 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.906 GB, free space: 5.250GB, frag space: 0.207GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:12 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.58GB/s
INFO 09-18 07:19:12 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.791 GB, free space: 1.365GB, frag space: 4.090GB
INFO 09-18 07:19:12 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.791 GB, free space: 1.365GB, frag space: 4.090GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:12 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.791 GB, free space: 1.365GB, frag space: 4.090GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.36GB/s
INFO 09-18 07:19:13 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.575GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:13 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.932 GB, free space: 0.224GB, frag space: 1.434GB
INFO 09-18 07:19:13 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB
INFO 09-18 07:19:13 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:13 llm_engine.py:773] Finished liquid for 67 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.04s, move and shrink latency: 0.12s, update worker latency: -0.11s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.40s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, current gpu block: #964
INFO 09-18 07:19:13 llm_engine.py:759] ---------Start 68'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:13 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:13 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.980 GB, free space: 1.175GB, frag space: 0.483GB, [(898899, 22.482421875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.22s to send model shards
INFO 09-18 07:19:13 worker.py:152] send weights shards takes: 0.54s, sent out: 6.19GB, sent bw: 11.37GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:13 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 15.000 GB, free space: 7.156GB, frag space: 0.696GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:13 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.76GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:13 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:14 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:14 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.131 GB, free space: 11.025GB, frag space: 0.624GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2216
INFO 09-18 07:19:14 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3180
INFO 09-18 07:19:14 worker.py:202] extend gpu in worker takes: 0.35s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:14 worker.py:202] extend gpu in worker takes: 0.35s
INFO 09-18 07:19:14 llm_engine.py:773] Finished liquid for 68 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.10s, update worker latency: 0.00s, liquid model weights latency: 0.59s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.35s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.696GB, current gpu block: #3180
INFO 09-18 07:19:14 llm_engine.py:759] ---------Start 69'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:14 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:14 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.698GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:14 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:14 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:14 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.25s to send model shards
INFO 09-18 07:19:14 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 11.07GB/s
INFO 09-18 07:19:14 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.082 GB, reserved space on GPU 0: 16.551 GB, free space: 5.605GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:14 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:15 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.21GB, sent bw: 14.66GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:15 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:15 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.277GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:15 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.125GB
INFO 09-18 07:19:15 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:15 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
INFO 09-18 07:19:15 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:15 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, [(898899, 11.865234375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:15 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:15 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:15 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:15 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.48GB/s
INFO 09-18 07:19:15 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.784GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:15 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:16 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.21GB, sent bw: 15.23GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:16 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:16 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.277GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:16 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.125GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:16 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:16 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:16 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8005
INFO 09-18 07:19:16 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:16 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:16 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:16 worker.py:202] extend gpu in worker takes: 0.41s
INFO 09-18 07:19:16 llm_engine.py:773] Finished liquid for 69 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.38s, update worker latency: 0.01s, liquid model weights latency: 1.23s, init mem latency: 0.00s, liquid kvc latency: 0.72s, extending gpu blocks latency: 0.41s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.280 GB, reserved space on GPU 0: 19.801 GB, free space: 2.355GB, frag space: 0.521GB, current gpu block: #8005
INFO 09-18 07:19:16 llm_engine.py:759] ---------Start 70'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:16 multiproc_gpu_executor.py:242] Shrink to: #3180, currently using blocks: #5
INFO 09-18 07:19:16 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.280 GB, reserved space on GPU 0: 19.803 GB, free space: 2.353GB, frag space: 0.523GB
INFO 09-18 07:19:17 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB
INFO 09-18 07:19:17 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:17 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, [(898899, 11.865234375)]
INFO 09-18 07:19:17 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB
INFO 09-18 07:19:17 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 13.219 GB, free space: 8.937GB, frag space: 0.267GB
INFO 09-18 07:19:17 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.381 GB, free space: 5.775GB, frag space: 3.429GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:17 worker.py:152] send weights shards takes: 0.36s, sent out: 3.10GB, sent bw: 8.67GB/s
INFO 09-18 07:19:17 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.381 GB, free space: 5.775GB, frag space: 3.429GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:17 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.381 GB, free space: 5.775GB, frag space: 3.429GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:17 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.21GB, sent bw: 13.44GB/s
INFO 09-18 07:19:17 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.163 GB, reserved space on GPU 0: 19.662 GB, free space: 2.494GB, frag space: 0.499GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:17 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:18 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 20.381 GB, free space: 1.775GB, frag space: 1.202GB
INFO 09-18 07:19:18 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.421GB
INFO 09-18 07:19:18 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.421GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:18 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:18 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.421GB, [(898899, 21.1015625)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:18 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.856 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.215GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:18 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.294GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:18 worker.py:152] send weights shards takes: 0.49s, sent out: 3.10GB, sent bw: 6.35GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:18 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.097GB
INFO 09-18 07:19:18 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.421GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:18 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:19 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.21GB, sent bw: 14.91GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:19 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.163 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.226GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:19 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:19 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 20.107 GB, free space: 1.934GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:19 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 19.326 GB, free space: 2.716GB, frag space: 0.147GB
INFO 09-18 07:19:19 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.421GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.716GB, frag space: 0.000GB
INFO 09-18 07:19:19 llm_engine.py:773] Finished liquid for 70 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.65s, move and shrink latency: -1726640356.82s, update worker latency: 1726640356.82s, liquid model weights latency: 1.92s, init mem latency: 0.00s, liquid kvc latency: 0.71s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.600 GB, free space: 2.556GB, frag space: 0.421GB, current gpu block: #3180
INFO 09-18 07:19:19 llm_engine.py:759] ---------Start 71'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:19 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #5
INFO 09-18 07:19:19 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.602 GB, free space: 2.554GB, frag space: 0.423GB
INFO 09-18 07:19:19 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.975 GB, free space: 11.181GB, frag space: 0.468GB
INFO 09-18 07:19:19 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:19 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.975 GB, free space: 11.181GB, frag space: 0.468GB, [(898899, 12.4765625)]
INFO 09-18 07:19:19 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.975 GB, free space: 11.181GB, frag space: 0.468GB
INFO 09-18 07:19:19 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.918 GB, free space: 5.238GB, frag space: 0.218GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.31s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:20 worker.py:152] send weights shards takes: 0.34s, sent out: 6.19GB, sent bw: 17.99GB/s
INFO 09-18 07:19:20 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.959 GB, free space: 1.197GB, frag space: 4.258GB
INFO 09-18 07:19:20 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.959 GB, free space: 1.197GB, frag space: 4.258GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:20 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.959 GB, free space: 1.197GB, frag space: 4.258GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:20 cache_engine.py:159] send kvc shards takes: 0.20s, sent out: 3.77GB, sent bw: 19.00GB/s
INFO 09-18 07:19:20 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.072 GB, free space: 1.084GB, frag space: 0.606GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:20 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:20 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.963 GB, free space: 0.193GB, frag space: 1.465GB
INFO 09-18 07:19:20 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.512GB
INFO 09-18 07:19:20 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.512GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:20 llm_engine.py:773] Finished liquid for 71 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.04s, move and shrink latency: 0.12s, update worker latency: -0.12s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.41s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.010 GB, free space: 1.146GB, frag space: 0.512GB, current gpu block: #964
INFO 09-18 07:19:20 llm_engine.py:759] ---------Start 72'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:20 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:20 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.012 GB, free space: 1.144GB, frag space: 0.514GB, [(898899, 22.513671875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:20 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:20 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.26s to send model shards
INFO 09-18 07:19:21 worker.py:152] send weights shards takes: 0.55s, sent out: 6.19GB, sent bw: 11.19GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:21 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:21 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.938 GB, free space: 7.218GB, frag space: 0.634GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:21 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:21 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.81GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:21 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:21 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:21 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:21 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:21 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.068 GB, free space: 11.088GB, frag space: 0.561GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2232
INFO 09-18 07:19:21 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3196
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:21 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:19:21 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:19:21 llm_engine.py:773] Finished liquid for 72 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.14s, update worker latency: 0.00s, liquid model weights latency: 0.60s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.634GB, current gpu block: #3196
INFO 09-18 07:19:21 llm_engine.py:759] ---------Start 73'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:21 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:21 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.636GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:21 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:22 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:22 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.28s to send model shards
INFO 09-18 07:19:22 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 10.01GB/s
INFO 09-18 07:19:22 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.145 GB, reserved space on GPU 0: 16.504 GB, free space: 5.652GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:22 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:22 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
INFO 09-18 07:19:22 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.24GB, sent bw: 14.26GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:22 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:22 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
INFO 09-18 07:19:22 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:22 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
INFO 09-18 07:19:22 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:22 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, [(898899, 11.755859375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:22 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:23 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:23 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.27s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:23 worker.py:152] send weights shards takes: 0.30s, sent out: 3.10GB, sent bw: 10.26GB/s
INFO 09-18 07:19:23 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.721GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:23 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:23 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.24GB, sent bw: 15.18GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:23 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:23 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:23 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:23 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:23 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:23 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8077
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:24 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:24 worker.py:202] extend gpu in worker takes: 0.39s
INFO 09-18 07:19:24 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:24 worker.py:202] extend gpu in worker takes: 0.42s
INFO 09-18 07:19:24 llm_engine.py:773] Finished liquid for 73 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.42s, update worker latency: 0.01s, liquid model weights latency: 1.34s, init mem latency: 0.00s, liquid kvc latency: 0.64s, extending gpu blocks latency: 0.42s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.420 GB, reserved space on GPU 0: 19.816 GB, free space: 2.339GB, frag space: 0.396GB, current gpu block: #8077
INFO 09-18 07:19:24 llm_engine.py:759] ---------Start 74'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:24 multiproc_gpu_executor.py:242] Shrink to: #3196, currently using blocks: #5
INFO 09-18 07:19:24 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.420 GB, reserved space on GPU 0: 19.818 GB, free space: 2.338GB, frag space: 0.398GB
INFO 09-18 07:19:24 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB
INFO 09-18 07:19:24 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:24 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, [(898899, 11.755859375)]
INFO 09-18 07:19:24 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB
INFO 09-18 07:19:24 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 13.230 GB, free space: 8.925GB, frag space: 0.239GB
INFO 09-18 07:19:24 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.502 GB, free space: 5.654GB, frag space: 3.511GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.35s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:24 worker.py:152] send weights shards takes: 0.37s, sent out: 3.10GB, sent bw: 8.34GB/s
INFO 09-18 07:19:24 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.502 GB, free space: 5.654GB, frag space: 3.511GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:24 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.502 GB, free space: 5.654GB, frag space: 3.511GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:25 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.24GB, sent bw: 13.61GB/s
INFO 09-18 07:19:25 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.343GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:25 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:25 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 20.365 GB, free space: 1.791GB, frag space: 1.124GB
INFO 09-18 07:19:25 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.343GB
INFO 09-18 07:19:25 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.343GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:25 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:25 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.343GB, [(898899, 21.0859375)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:25 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.895 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:25 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:26 worker.py:152] send weights shards takes: 0.48s, sent out: 3.10GB, sent bw: 6.41GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:26 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
INFO 09-18 07:19:26 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.343GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:26 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:26 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.24GB, sent bw: 14.72GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:26 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:26 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:26 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 20.170 GB, free space: 1.872GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:26 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
INFO 09-18 07:19:26 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.343GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.653GB, frag space: 0.000GB
INFO 09-18 07:19:26 llm_engine.py:773] Finished liquid for 74 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.66s, move and shrink latency: -1726640364.22s, update worker latency: 1726640364.23s, liquid model weights latency: 1.93s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.584 GB, free space: 2.572GB, frag space: 0.343GB, current gpu block: #3196
INFO 09-18 07:19:26 llm_engine.py:759] ---------Start 75'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:26 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #5
INFO 09-18 07:19:26 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.586 GB, free space: 2.570GB, frag space: 0.345GB
INFO 09-18 07:19:27 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.896 GB, free space: 11.259GB, frag space: 0.390GB
INFO 09-18 07:19:27 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:27 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.896 GB, free space: 11.259GB, frag space: 0.390GB, [(898899, 12.3984375)]
INFO 09-18 07:19:27 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.896 GB, free space: 11.259GB, frag space: 0.390GB
INFO 09-18 07:19:27 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.902 GB, free space: 5.254GB, frag space: 0.203GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:27 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.70GB/s
INFO 09-18 07:19:27 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.912 GB, free space: 1.244GB, frag space: 4.212GB
INFO 09-18 07:19:27 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.912 GB, free space: 1.244GB, frag space: 4.212GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:27 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.912 GB, free space: 1.244GB, frag space: 4.212GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:27 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.90GB/s
INFO 09-18 07:19:27 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.062 GB, free space: 1.093GB, frag space: 0.596GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:27 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:27 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.947 GB, free space: 0.209GB, frag space: 1.450GB
INFO 09-18 07:19:27 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB
INFO 09-18 07:19:27 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:27 llm_engine.py:773] Finished liquid for 75 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.02s, move and shrink latency: 0.11s, update worker latency: -0.11s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.40s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.994 GB, free space: 1.162GB, frag space: 0.497GB, current gpu block: #964
INFO 09-18 07:19:27 llm_engine.py:759] ---------Start 76'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:27 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:28 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.996 GB, free space: 1.160GB, frag space: 0.499GB, [(898899, 22.498046875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:28 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:28 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
It takes: 0.23s to send model shards
INFO 09-18 07:19:28 worker.py:152] send weights shards takes: 0.56s, sent out: 6.19GB, sent bw: 10.97GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:28 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:28 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.891 GB, free space: 7.265GB, frag space: 0.587GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:28 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:28 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.76GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:28 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:28 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:28 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:28 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:28 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.021 GB, free space: 11.134GB, frag space: 0.515GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2244
INFO 09-18 07:19:28 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3208
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:29 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:19:29 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:19:29 llm_engine.py:773] Finished liquid for 76 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.14s, update worker latency: 0.00s, liquid model weights latency: 0.60s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.891 GB, free space: 2.265GB, frag space: 0.587GB, current gpu block: #3208
INFO 09-18 07:19:29 llm_engine.py:759] ---------Start 77'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:29 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:29 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.893 GB, free space: 2.263GB, frag space: 0.589GB, [(898899, 21.39453125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:29 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:29 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:29 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.28s to send model shards
INFO 09-18 07:19:29 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 10.07GB/s
INFO 09-18 07:19:29 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.207 GB, reserved space on GPU 0: 16.723 GB, free space: 5.433GB, frag space: 0.515GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:29 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:29 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.27GB, sent bw: 14.85GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:29 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.887 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.090GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:29 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.887 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.287GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:29 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.887 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.132GB
INFO 09-18 07:19:30 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:30 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.473 GB, free space: 11.683GB, frag space: 0.562GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:19:30 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:30 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.473 GB, free space: 11.683GB, frag space: 0.562GB, [(898899, 11.974609375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:30 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:30 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:30 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.24s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:30 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.41GB/s
INFO 09-18 07:19:30 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.473 GB, free space: 11.683GB, frag space: 0.562GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:30 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:30 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.27GB, sent bw: 15.21GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:30 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.887 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.090GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:31 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.887 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.287GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:31 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.887 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.132GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:31 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:31 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.473 GB, free space: 11.683GB, frag space: 0.562GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:31 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #7977
INFO 09-18 07:19:31 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:31 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:31 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:31 worker.py:202] extend gpu in worker takes: 0.40s
INFO 09-18 07:19:31 llm_engine.py:773] Finished liquid for 77 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.45s, update worker latency: 0.00s, liquid model weights latency: 1.28s, init mem latency: 0.00s, liquid kvc latency: 0.70s, extending gpu blocks latency: 0.40s, update blocks latency: 0.07s;, current mem info on GPU0: allocated space on GPU 0: 19.225 GB, reserved space on GPU 0: 19.785 GB, free space: 2.371GB, frag space: 0.560GB, current gpu block: #7977
INFO 09-18 07:19:31 llm_engine.py:759] ---------Start 78'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:31 multiproc_gpu_executor.py:242] Shrink to: #3208, currently using blocks: #6
INFO 09-18 07:19:31 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.225 GB, reserved space on GPU 0: 19.787 GB, free space: 2.369GB, frag space: 0.562GB
INFO 09-18 07:19:31 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.473 GB, free space: 11.683GB, frag space: 0.562GB
INFO 09-18 07:19:31 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:31 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.473 GB, free space: 11.683GB, frag space: 0.562GB, [(898899, 11.974609375)]
INFO 09-18 07:19:31 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.910 GB, reserved space on GPU 0: 10.473 GB, free space: 11.683GB, frag space: 0.562GB
INFO 09-18 07:19:32 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 13.297 GB, free space: 8.859GB, frag space: 0.290GB
INFO 09-18 07:19:32 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 16.396 GB, free space: 5.759GB, frag space: 3.390GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.31s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:32 worker.py:152] send weights shards takes: 0.33s, sent out: 3.10GB, sent bw: 9.27GB/s
INFO 09-18 07:19:32 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 16.396 GB, free space: 5.759GB, frag space: 3.390GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:32 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.007 GB, reserved space on GPU 0: 16.396 GB, free space: 5.759GB, frag space: 3.390GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:32 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.27GB, sent bw: 14.01GB/s
INFO 09-18 07:19:32 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.272 GB, reserved space on GPU 0: 19.736 GB, free space: 2.420GB, frag space: 0.464GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:32 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:33 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 20.463 GB, free space: 1.693GB, frag space: 1.159GB
INFO 09-18 07:19:33 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.674 GB, free space: 2.482GB, frag space: 0.370GB
INFO 09-18 07:19:33 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.674 GB, free space: 2.482GB, frag space: 0.370GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:33 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:33 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.674 GB, free space: 2.482GB, frag space: 0.370GB, [(898899, 21.17578125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:33 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.910 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.222GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:33 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.007 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.302GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:33 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.007 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.104GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.62s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:33 worker.py:152] send weights shards takes: 0.65s, sent out: 3.10GB, sent bw: 4.80GB/s
INFO 09-18 07:19:33 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.674 GB, free space: 2.482GB, frag space: 0.370GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:33 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.007 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.104GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:34 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.27GB, sent bw: 14.87GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:34 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.272 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.241GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:34 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:34 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.936GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:34 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.147GB
INFO 09-18 07:19:34 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.674 GB, free space: 2.482GB, frag space: 0.370GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:19:34 llm_engine.py:773] Finished liquid for 78 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.82s, move and shrink latency: -1726640371.66s, update worker latency: 1726640371.66s, liquid model weights latency: 2.08s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.674 GB, free space: 2.482GB, frag space: 0.370GB, current gpu block: #3208
INFO 09-18 07:19:34 llm_engine.py:759] ---------Start 79'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:34 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #6
INFO 09-18 07:19:34 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.676 GB, free space: 2.480GB, frag space: 0.372GB
INFO 09-18 07:19:34 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.924 GB, free space: 11.232GB, frag space: 0.417GB
INFO 09-18 07:19:34 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:34 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.924 GB, free space: 11.232GB, frag space: 0.417GB, [(898899, 12.42578125)]
INFO 09-18 07:19:34 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.924 GB, free space: 11.232GB, frag space: 0.417GB
INFO 09-18 07:19:34 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.898 GB, free space: 5.257GB, frag space: 0.199GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.34s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:35 worker.py:152] send weights shards takes: 0.37s, sent out: 6.19GB, sent bw: 16.86GB/s
INFO 09-18 07:19:35 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.846 GB, free space: 1.310GB, frag space: 4.145GB
INFO 09-18 07:19:35 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.846 GB, free space: 1.310GB, frag space: 4.145GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:35 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.846 GB, free space: 1.310GB, frag space: 4.145GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:35 cache_engine.py:159] send kvc shards takes: 0.20s, sent out: 3.77GB, sent bw: 19.09GB/s
INFO 09-18 07:19:35 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.025 GB, free space: 1.130GB, frag space: 0.559GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:35 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:35 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.916 GB, free space: 0.240GB, frag space: 1.419GB
INFO 09-18 07:19:35 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB
INFO 09-18 07:19:35 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:35 llm_engine.py:773] Finished liquid for 79 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.03s, move and shrink latency: 0.10s, update worker latency: -0.10s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.40s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB, current gpu block: #964
INFO 09-18 07:19:35 llm_engine.py:759] ---------Start 80'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:35 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:35 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.965 GB, free space: 1.191GB, frag space: 0.467GB, [(898899, 22.466796875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:35 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:36 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:36 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.54s to send model shards
INFO 09-18 07:19:36 worker.py:152] send weights shards takes: 0.59s, sent out: 6.19GB, sent bw: 10.55GB/s
INFO 09-18 07:19:36 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.953 GB, free space: 7.203GB, frag space: 0.649GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:36 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:36 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.58GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:36 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:36 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:36 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:36 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:36 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.084 GB, free space: 11.072GB, frag space: 0.577GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2228
INFO 09-18 07:19:36 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3192
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:36 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:19:36 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:19:36 llm_engine.py:773] Finished liquid for 80 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.17s, update worker latency: 0.00s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.891 GB, free space: 2.265GB, frag space: 0.649GB, current gpu block: #3192
INFO 09-18 07:19:36 llm_engine.py:759] ---------Start 81'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:36 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:36 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.893 GB, free space: 2.263GB, frag space: 0.651GB, [(898899, 21.39453125)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:36 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:37 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:37 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.29s to send model shards
INFO 09-18 07:19:37 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 9.96GB/s
INFO 09-18 07:19:37 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.145 GB, reserved space on GPU 0: 16.410 GB, free space: 5.746GB, frag space: 0.265GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:37 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:37 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.23GB, sent bw: 14.20GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:37 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:37 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:37 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
INFO 09-18 07:19:37 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:37 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.160 GB, free space: 11.996GB, frag space: 0.265GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
INFO 09-18 07:19:37 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:37 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.160 GB, free space: 11.996GB, frag space: 0.265GB, [(898899, 11.662109375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:37 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:38 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:38 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.27s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:38 worker.py:152] send weights shards takes: 0.65s, sent out: 3.10GB, sent bw: 4.77GB/s
INFO 09-18 07:19:38 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.160 GB, free space: 11.996GB, frag space: 0.265GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.721GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:38 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:38 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.23GB, sent bw: 15.14GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:38 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:38 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:38 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:38 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:38 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.160 GB, free space: 11.996GB, frag space: 0.265GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:38 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8109
INFO 09-18 07:19:39 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:39 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:39 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:39 worker.py:202] extend gpu in worker takes: 0.41s
INFO 09-18 07:19:39 llm_engine.py:773] Finished liquid for 81 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.56s, update worker latency: 0.01s, liquid model weights latency: 1.64s, init mem latency: 0.00s, liquid kvc latency: 0.49s, extending gpu blocks latency: 0.41s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.483 GB, reserved space on GPU 0: 19.785 GB, free space: 2.371GB, frag space: 0.302GB, current gpu block: #8109
INFO 09-18 07:19:39 llm_engine.py:759] ---------Start 82'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:39 multiproc_gpu_executor.py:242] Shrink to: #3192, currently using blocks: #6
INFO 09-18 07:19:39 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.483 GB, reserved space on GPU 0: 19.787 GB, free space: 2.369GB, frag space: 0.304GB
INFO 09-18 07:19:39 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.160 GB, free space: 11.996GB, frag space: 0.265GB
INFO 09-18 07:19:39 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:39 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.160 GB, free space: 11.996GB, frag space: 0.265GB, [(898899, 11.662109375)]
INFO 09-18 07:19:39 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.160 GB, free space: 11.996GB, frag space: 0.265GB
INFO 09-18 07:19:39 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 13.250 GB, free space: 8.906GB, frag space: 0.259GB
INFO 09-18 07:19:39 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.631 GB, free space: 5.525GB, frag space: 3.640GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.36s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:39 worker.py:152] send weights shards takes: 0.38s, sent out: 3.10GB, sent bw: 8.11GB/s
INFO 09-18 07:19:39 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.631 GB, free space: 5.525GB, frag space: 3.640GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:39 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.631 GB, free space: 5.525GB, frag space: 3.640GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:40 cache_engine.py:159] send kvc shards takes: 0.45s, sent out: 6.23GB, sent bw: 13.73GB/s
INFO 09-18 07:19:40 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.452GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:40 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:41 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 20.475 GB, free space: 1.681GB, frag space: 1.233GB
INFO 09-18 07:19:41 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.452GB
INFO 09-18 07:19:41 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.452GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:41 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:41 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.452GB, [(898899, 21.1953125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:41 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.895 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:41 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:41 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:41 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 10.88GB/s
INFO 09-18 07:19:41 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.452GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:41 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:41 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.23GB, sent bw: 14.78GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:41 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:41 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:42 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 20.170 GB, free space: 1.872GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:42 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
INFO 09-18 07:19:42 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.452GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.653GB, frag space: 0.000GB
INFO 09-18 07:19:42 llm_engine.py:773] Finished liquid for 82 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.78s, move and shrink latency: -1726640379.38s, update worker latency: 1726640379.39s, liquid model weights latency: 2.05s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.693 GB, free space: 2.463GB, frag space: 0.452GB, current gpu block: #3192
INFO 09-18 07:19:42 llm_engine.py:759] ---------Start 83'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:42 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #6
INFO 09-18 07:19:42 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.695 GB, free space: 2.461GB, frag space: 0.454GB
INFO 09-18 07:19:42 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.006 GB, free space: 11.150GB, frag space: 0.499GB
INFO 09-18 07:19:42 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:42 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.006 GB, free space: 11.150GB, frag space: 0.499GB, [(898899, 12.5078125)]
INFO 09-18 07:19:42 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.006 GB, free space: 11.150GB, frag space: 0.499GB
INFO 09-18 07:19:42 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.918 GB, free space: 5.238GB, frag space: 0.218GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.29s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:42 worker.py:152] send weights shards takes: 0.33s, sent out: 6.19GB, sent bw: 19.03GB/s
INFO 09-18 07:19:42 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.084 GB, free space: 1.072GB, frag space: 4.383GB
INFO 09-18 07:19:42 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.084 GB, free space: 1.072GB, frag space: 4.383GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:42 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 21.084 GB, free space: 1.072GB, frag space: 4.383GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:43 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.54GB/s
INFO 09-18 07:19:43 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.575GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:43 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:43 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.932 GB, free space: 0.224GB, frag space: 1.434GB
INFO 09-18 07:19:43 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB
INFO 09-18 07:19:43 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:43 llm_engine.py:773] Finished liquid for 83 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.36s, move and shrink latency: 0.12s, update worker latency: -0.12s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, current gpu block: #964
INFO 09-18 07:19:43 llm_engine.py:759] ---------Start 84'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:43 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:43 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.980 GB, free space: 1.175GB, frag space: 0.483GB, [(898899, 22.482421875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:43 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:43 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:43 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.23s to send model shards
INFO 09-18 07:19:43 worker.py:152] send weights shards takes: 0.28s, sent out: 6.19GB, sent bw: 22.28GB/s
INFO 09-18 07:19:43 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 15.000 GB, free space: 7.156GB, frag space: 0.696GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:43 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:44 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.68GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:44 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:44 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:44 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:44 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:44 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.131 GB, free space: 11.025GB, frag space: 0.624GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2216
INFO 09-18 07:19:44 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3180
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:44 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:19:44 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:19:44 llm_engine.py:773] Finished liquid for 84 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.86s, update worker latency: 0.00s, liquid model weights latency: 0.31s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.696GB, current gpu block: #3180
INFO 09-18 07:19:44 llm_engine.py:759] ---------Start 85'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:44 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:44 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.698GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:44 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:44 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:44 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.26s to send model shards
INFO 09-18 07:19:44 worker.py:152] send weights shards takes: 0.29s, sent out: 3.10GB, sent bw: 10.77GB/s
INFO 09-18 07:19:44 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.082 GB, reserved space on GPU 0: 16.551 GB, free space: 5.605GB, frag space: 0.468GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:44 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:45 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.21GB, sent bw: 14.78GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:45 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:45 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.277GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:45 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.832 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.125GB
INFO 09-18 07:19:45 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:45 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.798GB, frag space: 0.000GB
INFO 09-18 07:19:45 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:45 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, [(898899, 11.865234375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:45 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:45 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.27s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:45 worker.py:152] send weights shards takes: 0.53s, sent out: 3.10GB, sent bw: 5.85GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:45 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:45 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.784GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:45 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:46 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.21GB, sent bw: 15.21GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:46 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:46 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.277GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:46 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.832 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.125GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:46 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:46 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:46 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8005
INFO 09-18 07:19:46 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:46 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:46 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:46 worker.py:202] extend gpu in worker takes: 0.40s
INFO 09-18 07:19:46 llm_engine.py:773] Finished liquid for 85 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.42s, update worker latency: 0.01s, liquid model weights latency: 1.51s, init mem latency: 0.00s, liquid kvc latency: 0.49s, extending gpu blocks latency: 0.40s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.280 GB, reserved space on GPU 0: 19.801 GB, free space: 2.355GB, frag space: 0.521GB, current gpu block: #8005
INFO 09-18 07:19:46 llm_engine.py:759] ---------Start 86'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:46 multiproc_gpu_executor.py:242] Shrink to: #3180, currently using blocks: #6
INFO 09-18 07:19:46 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.280 GB, reserved space on GPU 0: 19.803 GB, free space: 2.353GB, frag space: 0.523GB
INFO 09-18 07:19:47 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB
INFO 09-18 07:19:47 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:47 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB, [(898899, 11.865234375)]
INFO 09-18 07:19:47 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.856 GB, reserved space on GPU 0: 10.363 GB, free space: 11.793GB, frag space: 0.507GB
INFO 09-18 07:19:47 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 13.219 GB, free space: 8.937GB, frag space: 0.267GB
INFO 09-18 07:19:47 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.334 GB, free space: 5.822GB, frag space: 3.382GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:47 worker.py:152] send weights shards takes: 0.35s, sent out: 3.10GB, sent bw: 8.80GB/s
INFO 09-18 07:19:47 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.334 GB, free space: 5.822GB, frag space: 3.382GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:47 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.952 GB, reserved space on GPU 0: 16.334 GB, free space: 5.822GB, frag space: 3.382GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:48 cache_engine.py:159] send kvc shards takes: 0.44s, sent out: 6.21GB, sent bw: 14.01GB/s
INFO 09-18 07:19:48 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.163 GB, reserved space on GPU 0: 19.572 GB, free space: 2.584GB, frag space: 0.409GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:48 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:48 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 20.291 GB, free space: 1.865GB, frag space: 1.112GB
INFO 09-18 07:19:48 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.510 GB, free space: 2.646GB, frag space: 0.331GB
INFO 09-18 07:19:48 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.510 GB, free space: 2.646GB, frag space: 0.331GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:19:48 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:48 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.510 GB, free space: 2.646GB, frag space: 0.331GB, [(898899, 21.01171875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:48 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.856 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.215GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:48 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.294GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:48 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:48 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 10.92GB/s
INFO 09-18 07:19:48 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.510 GB, free space: 2.646GB, frag space: 0.331GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:48 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.952 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:49 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.21GB, sent bw: 14.62GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:49 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.163 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.226GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:49 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:49 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 20.107 GB, free space: 1.934GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:49 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.179 GB, reserved space on GPU 1: 19.326 GB, free space: 2.716GB, frag space: 0.147GB
INFO 09-18 07:19:49 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.510 GB, free space: 2.646GB, frag space: 0.331GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.716GB, frag space: 0.000GB
INFO 09-18 07:19:49 llm_engine.py:773] Finished liquid for 86 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.75s, move and shrink latency: -1726640386.94s, update worker latency: 1726640386.95s, liquid model weights latency: 2.03s, init mem latency: 0.00s, liquid kvc latency: 0.71s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.510 GB, free space: 2.646GB, frag space: 0.331GB, current gpu block: #3180
INFO 09-18 07:19:49 llm_engine.py:759] ---------Start 87'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:49 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #6
INFO 09-18 07:19:49 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.179 GB, reserved space on GPU 0: 19.512 GB, free space: 2.644GB, frag space: 0.333GB
INFO 09-18 07:19:49 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.885 GB, free space: 11.271GB, frag space: 0.378GB
INFO 09-18 07:19:49 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:49 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.885 GB, free space: 11.271GB, frag space: 0.378GB, [(898899, 12.38671875)]
INFO 09-18 07:19:49 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.885 GB, free space: 11.271GB, frag space: 0.378GB
INFO 09-18 07:19:50 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.906 GB, free space: 5.250GB, frag space: 0.207GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.31s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:50 worker.py:152] send weights shards takes: 0.35s, sent out: 6.19GB, sent bw: 17.86GB/s
INFO 09-18 07:19:50 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.885 GB, free space: 1.271GB, frag space: 4.184GB
INFO 09-18 07:19:50 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.885 GB, free space: 1.271GB, frag space: 4.184GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:50 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.885 GB, free space: 1.271GB, frag space: 4.184GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:50 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.34GB/s
INFO 09-18 07:19:50 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.575GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:50 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:50 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.932 GB, free space: 0.224GB, frag space: 1.434GB
INFO 09-18 07:19:50 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB
INFO 09-18 07:19:50 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:50 llm_engine.py:773] Finished liquid for 87 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.05s, move and shrink latency: 0.11s, update worker latency: -0.10s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.41s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, current gpu block: #964
INFO 09-18 07:19:50 llm_engine.py:759] ---------Start 88'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:50 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:51 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.980 GB, free space: 1.175GB, frag space: 0.483GB, [(898899, 22.482421875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.22s to send model shards
INFO 09-18 07:19:51 worker.py:152] send weights shards takes: 0.27s, sent out: 6.19GB, sent bw: 23.09GB/s
INFO 09-18 07:19:51 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.875 GB, free space: 7.281GB, frag space: 0.571GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:51 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.63GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:51 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:51 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.006 GB, free space: 11.150GB, frag space: 0.499GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2248
INFO 09-18 07:19:51 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3212
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:51 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:19:51 worker.py:202] extend gpu in worker takes: 0.38s
INFO 09-18 07:19:51 llm_engine.py:773] Finished liquid for 88 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 1.15s, update worker latency: 0.00s, liquid model weights latency: 0.61s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.38s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.571GB, current gpu block: #3212
INFO 09-18 07:19:51 llm_engine.py:759] ---------Start 89'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:52 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:52 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.573GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:52 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:52 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:52 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.25s to send model shards
INFO 09-18 07:19:52 worker.py:152] send weights shards takes: 0.27s, sent out: 3.10GB, sent bw: 11.40GB/s
INFO 09-18 07:19:52 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.207 GB, reserved space on GPU 0: 16.629 GB, free space: 5.527GB, frag space: 0.422GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:52 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:52 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.27GB, sent bw: 14.84GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:52 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:52 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.279GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:52 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.895 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.125GB
INFO 09-18 07:19:52 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:19:52 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:19:52 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:19:52 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, [(898899, 11.880859375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:52 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:53 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:53 worker.py:152] send weights shards takes: 0.63s, sent out: 3.10GB, sent bw: 4.91GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:53 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:19:53 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:53 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:54 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.27GB, sent bw: 15.20GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:54 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.082GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:54 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.279GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:54 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.895 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.125GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:54 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:19:54 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:54 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8029
INFO 09-18 07:19:54 worker.py:202] extend gpu in worker takes: 0.35s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:54 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:54 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:54 worker.py:202] extend gpu in worker takes: 0.39s
INFO 09-18 07:19:54 llm_engine.py:773] Finished liquid for 89 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.50s, update worker latency: 0.01s, liquid model weights latency: 1.59s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.39s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.332 GB, reserved space on GPU 0: 19.754 GB, free space: 2.402GB, frag space: 0.422GB, current gpu block: #8029
INFO 09-18 07:19:54 llm_engine.py:759] ---------Start 90'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:19:54 multiproc_gpu_executor.py:242] Shrink to: #3212, currently using blocks: #6
INFO 09-18 07:19:54 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.332 GB, reserved space on GPU 0: 19.756 GB, free space: 2.400GB, frag space: 0.423GB
INFO 09-18 07:19:54 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB
INFO 09-18 07:19:54 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:19:54 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB, [(898899, 11.880859375)]
INFO 09-18 07:19:54 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.918 GB, reserved space on GPU 0: 10.379 GB, free space: 11.777GB, frag space: 0.461GB
INFO 09-18 07:19:55 worker.py:168] After recving weights shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 13.285 GB, free space: 8.871GB, frag space: 0.270GB
INFO 09-18 07:19:55 worker.py:171] After appending weights shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.400 GB, free space: 5.755GB, frag space: 3.386GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.32s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:55 worker.py:152] send weights shards takes: 0.34s, sent out: 3.10GB, sent bw: 9.08GB/s
INFO 09-18 07:19:55 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.400 GB, free space: 5.755GB, frag space: 3.386GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:55 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 13.015 GB, reserved space on GPU 0: 16.400 GB, free space: 5.755GB, frag space: 3.386GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:55 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.27GB, sent bw: 13.72GB/s
INFO 09-18 07:19:55 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.288 GB, reserved space on GPU 0: 19.717 GB, free space: 2.439GB, frag space: 0.429GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:55 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:19:56 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 20.443 GB, free space: 1.713GB, frag space: 1.140GB
INFO 09-18 07:19:56 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.654 GB, free space: 2.502GB, frag space: 0.351GB
INFO 09-18 07:19:56 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.654 GB, free space: 2.502GB, frag space: 0.351GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:19:56 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:19:56 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.654 GB, free space: 2.502GB, frag space: 0.351GB, [(898899, 21.15625)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:56 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.918 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.215GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:56 worker.py:168] After recving weights shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.294GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:56 worker.py:171] After appending weights shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:56 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 10.95GB/s
INFO 09-18 07:19:56 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.654 GB, free space: 2.502GB, frag space: 0.351GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:56 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 13.015 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:57 cache_engine.py:159] send kvc shards takes: 0.43s, sent out: 6.27GB, sent bw: 14.66GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:57 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.288 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.226GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:19:57 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:57 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.936GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:57 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.304 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.147GB
INFO 09-18 07:19:57 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.654 GB, free space: 2.502GB, frag space: 0.351GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:19:57 llm_engine.py:773] Finished liquid for 90 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.80s, move and shrink latency: -1726640394.54s, update worker latency: 1726640394.55s, liquid model weights latency: 2.06s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.654 GB, free space: 2.502GB, frag space: 0.351GB, current gpu block: #3212
INFO 09-18 07:19:57 llm_engine.py:759] ---------Start 91'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:19:57 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #6
INFO 09-18 07:19:57 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.304 GB, reserved space on GPU 0: 19.656 GB, free space: 2.500GB, frag space: 0.353GB
INFO 09-18 07:19:57 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.904 GB, free space: 11.252GB, frag space: 0.397GB
INFO 09-18 07:19:57 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:19:57 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.904 GB, free space: 11.252GB, frag space: 0.397GB, [(898899, 12.40625)]
INFO 09-18 07:19:57 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.904 GB, free space: 11.252GB, frag space: 0.397GB
INFO 09-18 07:19:57 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.895 GB, free space: 5.261GB, frag space: 0.195GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:57 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 17.21GB/s
INFO 09-18 07:19:57 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.686 GB, free space: 1.470GB, frag space: 3.985GB
INFO 09-18 07:19:57 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.686 GB, free space: 1.470GB, frag space: 3.985GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:19:57 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.686 GB, free space: 1.470GB, frag space: 3.985GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:58 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 20.33GB/s
INFO 09-18 07:19:58 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.041 GB, free space: 1.115GB, frag space: 0.575GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:58 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:19:58 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.932 GB, free space: 0.224GB, frag space: 1.434GB
INFO 09-18 07:19:58 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB
INFO 09-18 07:19:58 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:19:58 llm_engine.py:773] Finished liquid for 91 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.37s, move and shrink latency: 0.10s, update worker latency: -0.10s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.74s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.979 GB, free space: 1.177GB, frag space: 0.481GB, current gpu block: #964
INFO 09-18 07:19:58 llm_engine.py:759] ---------Start 92'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:19:58 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:19:58 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.980 GB, free space: 1.175GB, frag space: 0.483GB, [(898899, 22.482421875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:58 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:59 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:59 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.24s to send model shards
INFO 09-18 07:19:59 worker.py:152] send weights shards takes: 0.29s, sent out: 6.19GB, sent bw: 21.55GB/s
INFO 09-18 07:19:59 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.906 GB, free space: 7.250GB, frag space: 0.603GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:59 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:19:59 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.76GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:59 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:59 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:59 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:19:59 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:19:59 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.037 GB, free space: 11.119GB, frag space: 0.530GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2240
INFO 09-18 07:19:59 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3204
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:19:59 worker.py:202] extend gpu in worker takes: 0.36s
INFO 09-18 07:19:59 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:19:59 llm_engine.py:773] Finished liquid for 92 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.86s, update worker latency: 0.00s, liquid model weights latency: 0.33s, init mem latency: 0.00s, liquid kvc latency: 0.15s, extending gpu blocks latency: 0.37s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.906 GB, free space: 2.250GB, frag space: 0.649GB, current gpu block: #3204
INFO 09-18 07:19:59 llm_engine.py:759] ---------Start 93'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:19:59 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:19:59 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.908 GB, free space: 2.248GB, frag space: 0.651GB, [(898899, 21.41015625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:59 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:19:59 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:00 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.28s to send model shards
INFO 09-18 07:20:00 worker.py:152] send weights shards takes: 0.31s, sent out: 3.10GB, sent bw: 10.08GB/s
INFO 09-18 07:20:00 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.160 GB, reserved space on GPU 0: 16.535 GB, free space: 5.621GB, frag space: 0.375GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:00 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:20:00 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.26GB, sent bw: 14.80GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:00 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 10.977 GB, free space: 11.562GB, frag space: 1.097GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:00 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 11.174 GB, free space: 11.365GB, frag space: 1.295GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:00 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.879 GB, reserved space on GPU 2: 10.020 GB, free space: 12.519GB, frag space: 0.140GB
INFO 09-18 07:20:00 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:20:00 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.285 GB, free space: 11.871GB, frag space: 0.382GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.673GB, frag space: 0.000GB
INFO 09-18 07:20:00 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:20:00 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.285 GB, free space: 11.871GB, frag space: 0.382GB, [(898899, 11.787109375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:00 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:01 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:01 worker.py:152] send weights shards takes: 0.53s, sent out: 3.10GB, sent bw: 5.84GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:01 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:20:01 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.285 GB, free space: 11.871GB, frag space: 0.382GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.659GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:01 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:01 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.26GB, sent bw: 15.28GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:01 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 10.977 GB, free space: 11.562GB, frag space: 1.097GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:01 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 11.174 GB, free space: 11.365GB, frag space: 1.295GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:01 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.879 GB, reserved space on GPU 3: 10.020 GB, free space: 12.519GB, frag space: 0.140GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:01 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:20:01 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.285 GB, free space: 11.871GB, frag space: 0.382GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:20:01 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8069
INFO 09-18 07:20:02 worker.py:202] extend gpu in worker takes: 0.38s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:02 worker.py:202] extend gpu in worker takes: 0.39s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:02 worker.py:202] extend gpu in worker takes: 0.40s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:02 worker.py:202] extend gpu in worker takes: 0.41s
INFO 09-18 07:20:02 llm_engine.py:773] Finished liquid for 93 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.45s, update worker latency: 0.01s, liquid model weights latency: 1.52s, init mem latency: 0.00s, liquid kvc latency: 0.49s, extending gpu blocks latency: 0.42s, update blocks latency: 0.01s;, current mem info on GPU0: allocated space on GPU 0: 19.405 GB, reserved space on GPU 0: 19.785 GB, free space: 2.371GB, frag space: 0.381GB, current gpu block: #8069
INFO 09-18 07:20:02 llm_engine.py:759] ---------Start 94'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:20:02 multiproc_gpu_executor.py:242] Shrink to: #3204, currently using blocks: #7
INFO 09-18 07:20:02 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.405 GB, reserved space on GPU 0: 19.787 GB, free space: 2.369GB, frag space: 0.382GB
INFO 09-18 07:20:02 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.285 GB, free space: 11.871GB, frag space: 0.382GB
INFO 09-18 07:20:02 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:20:02 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.285 GB, free space: 11.871GB, frag space: 0.382GB, [(898899, 11.787109375)]
INFO 09-18 07:20:02 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.903 GB, reserved space on GPU 0: 10.285 GB, free space: 11.871GB, frag space: 0.382GB
INFO 09-18 07:20:02 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 13.289 GB, free space: 8.867GB, frag space: 0.290GB
INFO 09-18 07:20:02 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.529 GB, free space: 5.627GB, frag space: 3.530GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:02 worker.py:152] send weights shards takes: 0.36s, sent out: 3.10GB, sent bw: 8.65GB/s
INFO 09-18 07:20:02 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.529 GB, free space: 5.627GB, frag space: 3.530GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:20:02 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.999 GB, reserved space on GPU 0: 16.529 GB, free space: 5.627GB, frag space: 3.530GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:03 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.26GB, sent bw: 13.70GB/s
INFO 09-18 07:20:03 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.752 GB, free space: 2.404GB, frag space: 0.495GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:03 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:20:03 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 20.479 GB, free space: 1.677GB, frag space: 1.222GB
INFO 09-18 07:20:03 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.689 GB, free space: 2.466GB, frag space: 0.433GB
INFO 09-18 07:20:03 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.689 GB, free space: 2.466GB, frag space: 0.433GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.909GB, frag space: 0.000GB
INFO 09-18 07:20:03 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:20:03 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.689 GB, free space: 2.466GB, frag space: 0.433GB, [(898899, 21.19140625)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:03 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.903 GB, reserved space on GPU 1: 10.133 GB, free space: 11.909GB, frag space: 0.230GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:04 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 13.309 GB, free space: 8.733GB, frag space: 0.310GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:04 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.112GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.26s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:04 worker.py:152] send weights shards takes: 0.28s, sent out: 3.10GB, sent bw: 10.95GB/s
INFO 09-18 07:20:04 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.689 GB, free space: 2.466GB, frag space: 0.433GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.930GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:04 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.999 GB, reserved space on GPU 1: 16.111 GB, free space: 5.930GB, frag space: 3.112GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:04 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.26GB, sent bw: 14.88GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:04 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 19.514 GB, free space: 2.528GB, frag space: 0.257GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:04 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:04 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 20.240 GB, free space: 1.802GB, frag space: 0.983GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:04 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.257 GB, reserved space on GPU 1: 19.451 GB, free space: 2.591GB, frag space: 0.194GB
INFO 09-18 07:20:04 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.689 GB, free space: 2.466GB, frag space: 0.433GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.591GB, frag space: 0.000GB
INFO 09-18 07:20:04 llm_engine.py:773] Finished liquid for 94 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.79s, move and shrink latency: -1726640402.16s, update worker latency: 1726640402.16s, liquid model weights latency: 2.06s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.689 GB, free space: 2.466GB, frag space: 0.433GB, current gpu block: #3204
INFO 09-18 07:20:04 llm_engine.py:759] ---------Start 95'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:20:04 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #7
INFO 09-18 07:20:04 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.257 GB, reserved space on GPU 0: 19.691 GB, free space: 2.464GB, frag space: 0.435GB
INFO 09-18 07:20:05 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.939 GB, free space: 11.216GB, frag space: 0.433GB
INFO 09-18 07:20:05 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:20:05 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.939 GB, free space: 11.216GB, frag space: 0.433GB, [(898899, 12.44140625)]
INFO 09-18 07:20:05 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.939 GB, free space: 11.216GB, frag space: 0.433GB
INFO 09-18 07:20:05 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.898 GB, free space: 5.257GB, frag space: 0.199GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:05 worker.py:152] send weights shards takes: 0.36s, sent out: 6.19GB, sent bw: 16.99GB/s
INFO 09-18 07:20:05 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.908 GB, free space: 1.248GB, frag space: 4.208GB
INFO 09-18 07:20:05 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.908 GB, free space: 1.248GB, frag space: 4.208GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:20:05 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.908 GB, free space: 1.248GB, frag space: 4.208GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:05 cache_engine.py:159] send kvc shards takes: 0.19s, sent out: 3.77GB, sent bw: 19.48GB/s
INFO 09-18 07:20:05 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.045 GB, free space: 1.111GB, frag space: 0.579GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:20:06 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.936 GB, free space: 0.220GB, frag space: 1.438GB
INFO 09-18 07:20:06 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.982 GB, free space: 1.173GB, frag space: 0.485GB
INFO 09-18 07:20:06 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.982 GB, free space: 1.173GB, frag space: 0.485GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:20:06 llm_engine.py:773] Finished liquid for 95 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.36s, move and shrink latency: 0.10s, update worker latency: -0.10s, liquid model weights latency: 0.62s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.982 GB, free space: 1.173GB, frag space: 0.485GB, current gpu block: #964
INFO 09-18 07:20:06 llm_engine.py:759] ---------Start 96'th liquid: Scale out from GPU0 to GPU1---------
INFO 09-18 07:20:06 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 1 with shard_ids: [2, 3]
INFO 09-18 07:20:06 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.984 GB, free space: 1.172GB, frag space: 0.487GB, [(898899, 22.486328125)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 worker.py:165] Before appending weights shards, allocated space on GPU 1: 0.548 GB, reserved space on GPU 1: 0.561 GB, free space: 21.481GB, frag space: 0.012GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 worker.py:168] After recving weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 6.754 GB, free space: 15.288GB, frag space: 0.013GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 worker.py:171] After appending weights shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
It takes: 0.22s to send model shards
INFO 09-18 07:20:06 worker.py:152] send weights shards takes: 0.27s, sent out: 6.19GB, sent bw: 23.06GB/s
INFO 09-18 07:20:06 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 14.304 GB, reserved space on GPU 0: 14.938 GB, free space: 7.218GB, frag space: 0.634GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 13.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 6.741 GB, reserved space on GPU 1: 8.307 GB, free space: 13.735GB, frag space: 1.565GB
INFO 09-18 07:20:06 cache_engine.py:159] send kvc shards takes: 0.11s, sent out: 3.77GB, sent bw: 33.70GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 worker.py:217] After recv kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.119 GB, free space: 9.923GB, frag space: 1.612GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 worker.py:223] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 12.238 GB, free space: 9.804GB, frag space: 1.731GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:06 worker.py:228] After appending kvc shards, allocated space on GPU 1: 10.507 GB, reserved space on GPU 1: 10.619 GB, free space: 11.423GB, frag space: 0.112GB
INFO 09-18 07:20:06 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 1
INFO 09-18 07:20:06 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 11.068 GB, free space: 11.088GB, frag space: 0.561GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.423GB, frag space: 0.000GB
2232
INFO 09-18 07:20:06 multiproc_gpu_executor.py:171] After scale out, num_gpu_blocks: #3196
INFO 09-18 07:20:07 worker.py:202] extend gpu in worker takes: 0.37s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:07 worker.py:202] extend gpu in worker takes: 0.37s
INFO 09-18 07:20:07 llm_engine.py:773] Finished liquid for 96 times, output: Completed! Move shard: [2, 3] from [0] to [1];liquid e2e latency: 0.84s, update worker latency: 0.00s, liquid model weights latency: 0.31s, init mem latency: 0.00s, liquid kvc latency: 0.16s, extending gpu blocks latency: 0.37s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.875 GB, free space: 2.281GB, frag space: 0.634GB, current gpu block: #3196
INFO 09-18 07:20:07 llm_engine.py:759] ---------Start 97'th liquid: Scale out from GPU[0,1] to GPU[2,3]---------
INFO 09-18 07:20:07 multiproc_gpu_executor.py:258] Start to do liquid from src: 0 to dst: 2 with shard_ids: [1]
INFO 09-18 07:20:07 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.877 GB, free space: 2.279GB, frag space: 0.636GB, [(898899, 21.37890625)]
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:07 worker.py:165] Before appending weights shards, allocated space on GPU 2: 0.525 GB, reserved space on GPU 2: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:07 worker.py:168] After recving weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:07 worker.py:171] After appending weights shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
It takes: 0.26s to send model shards
INFO 09-18 07:20:07 worker.py:152] send weights shards takes: 0.34s, sent out: 3.10GB, sent bw: 9.22GB/s
INFO 09-18 07:20:07 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.145 GB, reserved space on GPU 0: 16.504 GB, free space: 5.652GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:07 worker.py:215] Before recv kvc shards, allocated space on GPU 2: 3.621 GB, reserved space on GPU 2: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
INFO 09-18 07:20:08 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.24GB, sent bw: 14.79GB/s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:08 worker.py:217] After recv kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:08 worker.py:223] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:08 worker.py:228] After appending kvc shards, allocated space on GPU 2: 9.871 GB, reserved space on GPU 2: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
INFO 09-18 07:20:08 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 2
INFO 09-18 07:20:08 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.735GB, frag space: 0.000GB
INFO 09-18 07:20:08 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 3 with shard_ids: [3]
INFO 09-18 07:20:08 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, [(898899, 11.755859375)]
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:08 worker.py:165] Before appending weights shards, allocated space on GPU 3: 0.525 GB, reserved space on GPU 3: 0.539 GB, free space: 22.000GB, frag space: 0.014GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:08 worker.py:168] After recving weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 3.887 GB, free space: 18.652GB, frag space: 0.265GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:08 worker.py:171] After appending weights shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.59s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:08 worker.py:152] send weights shards takes: 0.62s, sent out: 3.10GB, sent bw: 5.03GB/s
INFO 09-18 07:20:08 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.721GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:08 worker.py:215] Before recv kvc shards, allocated space on GPU 3: 3.621 GB, reserved space on GPU 3: 4.664 GB, free space: 17.875GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:09 cache_engine.py:159] send kvc shards takes: 0.41s, sent out: 6.24GB, sent bw: 15.16GB/s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:09 worker.py:217] After recv kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 10.914 GB, free space: 11.625GB, frag space: 1.043GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:09 worker.py:223] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 11.109 GB, free space: 11.429GB, frag space: 1.238GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:09 worker.py:228] After appending kvc shards, allocated space on GPU 3: 9.871 GB, reserved space on GPU 3: 9.957 GB, free space: 12.582GB, frag space: 0.086GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:09 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 3
INFO 09-18 07:20:09 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:20:09 multiproc_gpu_executor.py:189] After scale out, num_gpu_blocks: #8077
INFO 09-18 07:20:09 worker.py:202] extend gpu in worker takes: 0.42s
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:09 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:09 worker.py:202] extend gpu in worker takes: 0.43s
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:09 worker.py:202] extend gpu in worker takes: 0.43s
INFO 09-18 07:20:09 llm_engine.py:773] Finished liquid for 97 times, output: Completed! Move shard: [1, 3] from [0, 1] to [2, 3];liquid e2e latency: 2.53s, update worker latency: 0.00s, liquid model weights latency: 1.59s, init mem latency: 0.00s, liquid kvc latency: 0.50s, extending gpu blocks latency: 0.44s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.420 GB, reserved space on GPU 0: 19.816 GB, free space: 2.339GB, frag space: 0.396GB, current gpu block: #8077
INFO 09-18 07:20:09 llm_engine.py:759] ---------Start 98'th liquid: Scale in from GPU[2,3] to GPU[0,1]---------
INFO 09-18 07:20:09 multiproc_gpu_executor.py:242] Shrink to: #3196, currently using blocks: #7
INFO 09-18 07:20:09 multiproc_gpu_executor.py:243] Before move and shrink: allocated space on GPU 0: 19.420 GB, reserved space on GPU 0: 19.818 GB, free space: 2.338GB, frag space: 0.398GB
INFO 09-18 07:20:10 multiproc_gpu_executor.py:245] After move and shrink: allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB
INFO 09-18 07:20:10 multiproc_gpu_executor.py:258] Start to do liquid from src: 2 to dst: 0 with shard_ids: [1]
INFO 09-18 07:20:10 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB, [(898899, 11.755859375)]
INFO 09-18 07:20:10 worker.py:165] Before appending weights shards, allocated space on GPU 0: 9.895 GB, reserved space on GPU 0: 10.254 GB, free space: 11.902GB, frag space: 0.359GB
INFO 09-18 07:20:10 worker.py:168] After recving weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 13.230 GB, free space: 8.925GB, frag space: 0.239GB
INFO 09-18 07:20:10 worker.py:171] After appending weights shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.502 GB, free space: 5.654GB, frag space: 3.511GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m It takes: 0.33s to send model shards
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:10 worker.py:152] send weights shards takes: 0.35s, sent out: 3.10GB, sent bw: 8.80GB/s
INFO 09-18 07:20:10 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.502 GB, free space: 5.654GB, frag space: 3.511GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:20:10 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 12.991 GB, reserved space on GPU 0: 16.502 GB, free space: 5.654GB, frag space: 3.511GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:10 cache_engine.py:159] send kvc shards takes: 0.46s, sent out: 6.24GB, sent bw: 13.59GB/s
INFO 09-18 07:20:10 worker.py:217] After recv kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.678 GB, free space: 2.478GB, frag space: 0.436GB
[1;36m(VllmWorkerProcess pid=898983)[0;0m INFO 09-18 07:20:11 cache_engine.py:165] Successfully send kv cache shards: [1] to rank: 0
INFO 09-18 07:20:11 worker.py:223] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 20.459 GB, free space: 1.697GB, frag space: 1.218GB
INFO 09-18 07:20:11 worker.py:228] After appending kvc shards, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.678 GB, free space: 2.478GB, frag space: 0.436GB
INFO 09-18 07:20:11 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.678 GB, free space: 2.478GB, frag space: 0.436GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 11.971GB, frag space: 0.000GB
INFO 09-18 07:20:11 multiproc_gpu_executor.py:258] Start to do liquid from src: 3 to dst: 1 with shard_ids: [3]
INFO 09-18 07:20:11 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.678 GB, free space: 2.478GB, frag space: 0.436GB, [(898899, 21.1796875)]
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:11 worker.py:165] Before appending weights shards, allocated space on GPU 1: 9.895 GB, reserved space on GPU 1: 10.070 GB, free space: 11.971GB, frag space: 0.175GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:11 worker.py:168] After recving weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 13.246 GB, free space: 8.796GB, frag space: 0.255GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:11 worker.py:171] After appending weights shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m It takes: 0.27s to send model shards
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:11 worker.py:152] send weights shards takes: 0.30s, sent out: 3.10GB, sent bw: 10.48GB/s
INFO 09-18 07:20:11 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.678 GB, free space: 2.478GB, frag space: 0.436GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 5.993GB, frag space: 0.000GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:11 worker.py:215] Before recv kvc shards, allocated space on GPU 1: 12.991 GB, reserved space on GPU 1: 16.049 GB, free space: 5.993GB, frag space: 3.058GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:12 cache_engine.py:159] send kvc shards takes: 0.42s, sent out: 6.24GB, sent bw: 14.69GB/s
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:12 worker.py:217] After recv kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
[1;36m(VllmWorkerProcess pid=898984)[0;0m INFO 09-18 07:20:12 cache_engine.py:165] Successfully send kv cache shards: [3] to rank: 1
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:12 worker.py:223] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 20.170 GB, free space: 1.872GB, frag space: 0.929GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:12 worker.py:228] After appending kvc shards, allocated space on GPU 1: 19.241 GB, reserved space on GPU 1: 19.389 GB, free space: 2.653GB, frag space: 0.147GB
INFO 09-18 07:20:12 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.678 GB, free space: 2.478GB, frag space: 0.436GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 2.653GB, frag space: 0.000GB
INFO 09-18 07:20:12 llm_engine.py:773] Finished liquid for 98 times, output: Completed! Move shard: [1, 3] from [2, 3] to [0, 1];liquid e2e latency: 2.67s, move and shrink latency: -1726640409.80s, update worker latency: 1726640409.80s, liquid model weights latency: 1.93s, init mem latency: 0.00s, liquid kvc latency: 0.73s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.678 GB, free space: 2.478GB, frag space: 0.436GB, current gpu block: #3196
INFO 09-18 07:20:12 llm_engine.py:759] ---------Start 99'th liquid: Scale in from GPU1 to GPU 0---------
INFO 09-18 07:20:12 multiproc_gpu_executor.py:216] Shrink to: #964, currently using blocks: #7
INFO 09-18 07:20:12 multiproc_gpu_executor.py:217] Before move and shrink: on GPU: allocated space on GPU 0: 19.241 GB, reserved space on GPU 0: 19.680 GB, free space: 2.476GB, frag space: 0.438GB
INFO 09-18 07:20:12 multiproc_gpu_executor.py:219] After move and shrink: allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.990 GB, free space: 11.166GB, frag space: 0.483GB
INFO 09-18 07:20:12 multiproc_gpu_executor.py:258] Start to do liquid from src: 1 to dst: 0 with shard_ids: [2, 3]
INFO 09-18 07:20:12 multiproc_gpu_executor.py:265] Before liquid model weights, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.990 GB, free space: 11.166GB, frag space: 0.483GB, [(898899, 12.4921875)]
INFO 09-18 07:20:12 worker.py:165] Before appending weights shards, allocated space on GPU 0: 10.507 GB, reserved space on GPU 0: 10.990 GB, free space: 11.166GB, frag space: 0.483GB
INFO 09-18 07:20:12 worker.py:168] After recving weights shards, allocated space on GPU 0: 16.700 GB, reserved space on GPU 0: 16.902 GB, free space: 5.254GB, frag space: 0.203GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m It takes: 0.31s to send model shards
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:13 worker.py:152] send weights shards takes: 0.34s, sent out: 6.19GB, sent bw: 18.07GB/s
INFO 09-18 07:20:13 worker.py:171] After appending weights shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.818 GB, free space: 1.338GB, frag space: 4.118GB
INFO 09-18 07:20:13 multiproc_gpu_executor.py:270] After liquid model weights, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.818 GB, free space: 1.338GB, frag space: 4.118GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 17.669GB, frag space: 0.000GB
INFO 09-18 07:20:13 worker.py:215] Before recv kvc shards, allocated space on GPU 0: 16.701 GB, reserved space on GPU 0: 20.818 GB, free space: 1.338GB, frag space: 4.118GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:13 cache_engine.py:159] send kvc shards takes: 0.51s, sent out: 3.77GB, sent bw: 7.42GB/s
INFO 09-18 07:20:13 worker.py:217] After recv kvc shards, allocated space on GPU 0: 20.466 GB, reserved space on GPU 0: 21.025 GB, free space: 1.130GB, frag space: 0.559GB
[1;36m(VllmWorkerProcess pid=898982)[0;0m INFO 09-18 07:20:13 cache_engine.py:165] Successfully send kv cache shards: [2, 3] to rank: 0
INFO 09-18 07:20:13 worker.py:223] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 21.916 GB, free space: 0.240GB, frag space: 1.419GB
INFO 09-18 07:20:13 worker.py:228] After appending kvc shards, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB
INFO 09-18 07:20:13 multiproc_gpu_executor.py:280] After liquid kvc, allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB, allocated space on GPU 1: 0.000 GB, reserved space on GPU 1: 0.000 GB, free space: 21.481GB, frag space: 0.000GB
INFO 09-18 07:20:13 llm_engine.py:773] Finished liquid for 99 times, output: Completed! Move shard: [2, 3] from [1] to [0];liquid e2e latency: 1.36s, move and shrink latency: 0.11s, update worker latency: -0.10s, liquid model weights latency: 0.63s, init mem latency: 0.00s, liquid kvc latency: 0.72s, update blocks latency: 0.00s;, current mem info on GPU0: allocated space on GPU 0: 20.497 GB, reserved space on GPU 0: 20.963 GB, free space: 1.193GB, frag space: 0.465GB, current gpu block: #964
output: 
 reckoned to be the best in the world
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the world.
I thought it was the best in the
INFO 09-18 07:20:14 multiproc_worker_utils.py:123] Killing local vLLM worker processes
